\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Çifteþlik, Ýkizlik (Duality)

Bu benim en favori konularýmdan. Çok faydalý ve çok güzel bir teknik, bakýþ
açýsý. Bu konu üzerinde iki ders zamaný harcayacaðýz. Konuyu lineer
programlama (LP) üzerinden göreceðiz, çünkü bu alanda çifteþlik pratik
olarak rahatça gösterilebiliyor.

[önceki ders özeti atlandý]

Önümüzdeki iki ders için teori þapkamýzý takacaðýz, tabii çifteþliðin pek
çok optimizasyon problemi üzerinde çok ciddi etkileri var. Yani bu konu
bulutlar üzerinde, aþýrý soyut bir konu deðil, onu vurgulamak istiyorum. 

Ama þimdilik soyut denebilecek bir problemle baþlayalým. Diyelim ki elimde
bir LP var ve bu LP'nin optimal deðeri için bir alt sýnýr bulmak istiyorum,
$B \le \min_x f(x)$. Çifteþliðe bu çok basit soru üzerinden giriþ
yapacaðýz. Örnek

$$
\min_{x,y} x+y, \quad \textrm{öyle ki}
$$
$$
x + y \ge 2 
$$
$$
x,y \ge 0
$$

dogru olsun. 

Ýki skalar deðiþken var, ve pozitif olmalýlar. Bu problem için alt sýnýr
nedir? Çýplak gözle bile bakarak bunu bulabiliriz, cevap 2. Deðil mi? $x+y
\ge 2$ þartýna uymak gerekiyorsa alt sýnýr 2 olacaktýr. 

Bazýlarýnýz düþünebilir ki ``þanslýydýk, problem þartlarý aradýðýmýz þeyi
söylüyordu zaten''. Doðru fakat iddia ediyorum ki bu stratejiyi metodik bir
þekilde de kullanabilirdik. Benzer bir problem, 

$$
\min_{x,y} x + 3y, \quad \textrm{öyle ki}
$$
$$
x + y \ge 2 
$$
$$
x \ge 0, y \ge 0
$$

Bu problemin alt sýnýrýný nasýl buluruz?

Eðer $y \ge 0$ þartýný ikiyle çarparsak $2y \ge 0$ diye yeni bir þart elde
ederiz (hala doðru), bu yeni þartý alýp $x + y \ge 2 $'a eklersek $x + 3y
\ge 2 $ þeklinde bir þart daha elde etmiþ oluruz. Bu þart hedef
fonksiyonuna benzediði için alt sýnýrý direk söylüyor, alt sýnýr yine 2.
 
Üstteki probleme daha genel bir açýdan bakalým,

$$
\min_{x,y} px + qy, \quad \textrm{öyle ki}
$$
$$
x + y \ge 2
$$
$$
x,y \ge 0
$$

Alt sýnýr nedir? Öncekine göre biraz farklý bir strateji izleyeceðiz,
diyelim ki her þartý $a,b,c$ sabitleri ile çarptým, 

$$
ax + ay \ge 2a
$$
$$
bx \ge 0
$$
$$
cy \ge 0
$$

Bu tabii ki $a,b,c \ge 0$ ise yapýlabilir yoksa iþaretler deðiþirdi. Devam
edelim, yine bazý ek koþullar yaratmýþ oldum. Bu yeni þartlarý toplarsam
bir yeni þart daha elde ederim,

$$
(a+b)x + (a+c)y \ge 2a
$$

Yeni deðiþken isimleri $p,q$ atarsam

$$
px + qy \ge 2a
$$

atama

$$
a+b = p, \quad a+c = q
$$

Aslýnda alt sýnýrý iki üstteki denklemden bulmuþ olduk, $2a$ (bir üstteki
þartlara uyulduðu sürece tabii).

Eðer en iyi alt sýnýrý isteseydim, onu nasýl elde ederdim? Bu demektir ki
$2a$ olabildiðince büyük olmalý, tabii belli þartlara uyulduðu
sürece. Aslýnda bu soru bizi ikinci bir LP'ye götürüyor, literatürde ana
LP'nin çifteþi / ikizi denen LP'ye. Ýki deðiþkenli ortamda,

$$
\max_{a,b,c} 2a \quad \textrm{öyle ki}
$$
$$
a + b = p
$$
$$
a + c = q
$$
$$
a,b,c \ge 0
$$

Maksimum arandýðýna dikkat ve bu problemde üç tane deðiþken var (ana
problemde iki taneydi). Ve böylece deriz ki üstteki þartlara uyan her
$a,b,c$ (ki bu þartlara ikizin olurluk / fizibilite þartlarý deniyor)
maksimal noktada ana problemin alt sýnýrýný minimize eder.

Bir soru sorayým: acaba üstteki problemden bir eþitlik elde etmem mümkün
mü? Yani ikizdeki problemin optimal deðeri ana problemdeki optimal deðere
eþit olabilir mi? Cevap evet. Peki arada boþluk olmasý mümkün mü? Cevap
(bazen) evet. Ýyi bir sezgisel bakýþ bu, ana ve ikiz LP optimal deðerleri
neredeyse her zaman birbirine eþittir, bazý istanai patolojik durumlar
dýþýnda.

Farklý bir probleme bakalým. Bu problemde bir eþitlik te olacak. 

$$
\min_{a,b,c} px + qy \quad \textrm{öyle ki}
$$
$$
x \ge 0
$$
$$
y \le 1
$$
$$
3x + y = 2
$$

Ýkizi bulmak için her koþul için bir deðiþken atayalým, ama ondan önce her
ana koþulda eþitsizlikler ayný þekilde ise iþimiz daha rahatlaþýr (çünkü
$a,b,c,..$ deðiþkenlerini sýfýrdan büyük yapacaðýz, ama farklý yönleri
gösteren ana koþullar ile bu zorlaþýyor), $y \le 1$ yerine $-y \ge -1$
mesela, o zaman

$$
\min_{a,b,c} px + qy \quad \textrm{öyle ki}
$$
$$
x \ge 0
$$
$$
-y \ge -1
$$
$$
3x + y = 2
$$

Yine $a,b,c$ ile çarpýyorum, 

$$
a x \ge 0
$$
$$
-by \ge -b
$$
$$
3cx + cy = 2c
$$
$$
a,b \ge 0
$$


$c$ üzerinde koþul var mý? Hayýr, çünkü $c$'nin çarptýðý koþul bir eþitlik,
$c$ ne olursa olsun yeni koþul geçerli, iþaret deðiþiminden korkmaya gerek
yok.

Önceden olduðu gibi bir toplam alýyoruz, 

$$
(a+3c) x + (-b+c)y \ge -b + 2c
$$

Yine $p,q$ atamasýný yaparsam,

$$
p x + q y \ge -b + 2c
$$

$$
p = a+3c, \quad q = -b + c 
$$

Ýkiz problemi elde ettik, amaç ana problemin alt sýnýrý $-b+2c$'yi maksimize
etmek, üstteki iki þart ve $a,b \ge 0$ olacak þekilde. 

$$
\max_{a,b,c} 2c - b \quad \textrm{öyle ki}
$$
$$
a + 3c = p
$$
$$
-b + c = q
$$
$$
a,b \ge 0
$$

Dersin geri kalanýnda ikizlikten genel bir çerçevede bahsedeceðim, sonra 
bir ilginç örnek göreceðiz, ardýndan ikizliðe yeni bir bakýþ açýsýndan
yaklaþacaðýz, bu acý çok önemli olacak. Dersi ikinci bir örnekle
bitireceðiz. 

LP'lere tüm genelliði ile bakalým þimdi. Önceki format neler olup bittiðini
görmek açýsýndan faydalý, ama genel þablonu da görmek lazým. 

Tanýmlar

$c \in \mathbb{R}^n$, 
$A \in \mathbb{R}^{m \times n}$, 
$b \in \mathbb{R}^m$,
$G \in \mathbb{R}^{r \times n}$, 
$h \in \mathbb{R}^r$ verili. 

Ana Problem

$$
\min_x c^T x \quad \textrm{öyle ki}
$$
$$
Ax = b
$$
$$
Gx \le h
$$

Ýkiz Problem

$$
\max_{u,v} -b^T u - h^T v \quad \textrm{öyle ki}
$$
$$
-A^Tu - G^Tv = c
$$
$$
v \ge 0
$$

Ýkizi nasýl elde ettik? 

$Ax = b$ ve $Gx \le h$ için iki (vektör) deðiþkeni tanýmlýyoruz, sýrasýyla
$u,v$. $u$ için kýsýtlama yok, çünkü eþitlik için. Sadece $v \ge 0$
olmalý. 

Eger $x$ olurlu ise 

$$
a^T (Ax - b) + v^T (Gx-h) \le 0
$$

olur çünkü olurluluk noktasýnda $Ax - b=0$ ve $Gx-h \le 0$, bu sebeple
üstteki toplam tabii ki sýfýrdan küçük.

Gruplarsak,

$$
(A^T u + G^T v)^T x - b^Tu - h^T v \ge 0
$$

$$
(-A^T u - G^T v)^T x \ge  -b^Tu - h^T v 
$$

Parantez içini $c$'ye atarsam o zaman 

$$
c^T x \ge  -b^Tu - h^T v 
$$

Böylece eþitliðin sað tarafý alt sýnýrým olur, sol tarafý ise ikiz
deðiþkenlerim üzerinde kýsýtlama haline gelir, $v \ge 0$. Böylece ikiz
probleme eriþmiþ oluyoruz.

Sonraki ornege gelelim. Bu probleme maks akis min kesis (max flow min cut)
problemi deniyor. Konunun gelismesindeki ilginc bir hikaye 20. yuzyil
basinda Sovyetler maks akis Amerikalilar ise min kesis problemlerini
cozmeye odaklanmisti, fakat bu iki problem ikizlik uzerinden aslinda ayni
problem.

Maksimum akýþ problemi þöyle: bir yönlü çizit verildi diyelim,

\includegraphics[width=15em]{func_55_duality_01.png}

Ýki nokta arasýnda baðlantý varsa $c_{ij}$ o iki nokta $i,j$ arasýndaki
baðlantýnýn kapasitesini gösteriyor, eðer bir tren hattýndan bahsediyorsak
o baðlantýdan geçebilecek yük miktarý, eðer þu borusu ise oradan akabilecek
su miktarý, ya da bir yol ise o yolun uzunluðu, vs. olabilir. Bir
baðlantýdan gerçekte olan akýþý $f_{ij}$ olarak tanýmlayabiliriz,

$$
0 \le f_{ij} \le c_{ij}
$$

ve $i,j \in E$ olacak, burada $E$ tüm kenarlarýn (edges) indisleri, çizit
$G = (V,E)$ olarak tanýmlý, $V$ çizitin düðüm noktalarý (vertices). Bir
diðer þart (ki aslýnda bu bariz) bir düðüme giren akýþýn çýkan akýþla eþit
olmasý. 

$$
\sum_{(i,k) \in E} f_{ik} = \sum_{kj} f_{kj} \quad k \in V \backslash \{s,t\} 
$$

Not: $\backslash$ iþareti "hariç" demek. 

Maks akýþ problemi eldeki bir mali, nakliyatý diyelim, bir baþlangýç
noktasý $s$ bitiþi noktasý $t$'ye maksimum miktarda nakil edebilecek yollarý
bulmaktýr. Dikkat: $s$'den mal göndermek deyince $s$'den çýkan pek çok
yoldan nakliyat paylaþtýrýlarak gönderilebilir, altta görüldüðü gibi
(kýrmýzý hat kapasitesi, yeþil bir optimal akýþ örneði, baþlangýç 0 bitiþ
7).

\includegraphics[width=25em]{func_55_duality_02.png}

O zaman maksimum akýþý bir LP olarak kodlayalým,

$$
\max_{f \in \mathbb{R}^{|E|}} \sum_{(s,j)\in E} f_{sj}, \quad \textrm{öyle ki}
$$
$$
0 \le f_{ij} \le c_{ij}, \quad \forall i,j \in E
$$
$$
\sum_{(i,k) \in E} f_{ik} = \sum_{kj} f_{kj} \quad k \in V \backslash \{s,t\} 
$$

Fakat tek bir toplam ile tüm çizit üzerinden maksimum akýþý nasýl formülize
edebildik? Hedef fonksiyonundaki toplam sadece baþlangýç $s$'den çýkan
akýþa bakýyor? Buradaki ufak numara yaptýðýmýz kýsýtlamayla baðlantýlý,
akisin muhafaza edilmesini þart koþtuðumuz için optimal akýþ, her ne ise,
çýkýþ noktasýndan olan toplamý ile varýþ noktasýna giriþi ayný tutmalý
(aradaki geçiþ düðümleri için de ayný þey geçerli olduðu için tabii), bu
sebeple optimizasyonu tek bir toplam ile tanýmlayabildik. Üstteki grafik
örnekte görülüyor, çýkýþ toplam 3+2+1 varýþ toplam 4+2. O zaman çýkýþý
optimize edersek $t$'ye varan, tüm düðümler üzerinden olabilecek akýþý
maksimize etmiþ oluruz.

Bu programýn ikizini hesaplayabiliriz, üstteki bir LP ikizini bulmayi
biliyoruz, ana LP'dekiler kýsýtlamalar kadar yeni deðiþken elde ederiz,
vs.. Daha önce minimizasyon problemlerinin ikizine baktýk, ana problemde
bir alt sýnýr elde etmeye uðraþýyorduk. Þimdi ana problem maksimizasyon, o
zaman hedef için üst sýnýr aramak bizi ikize götürür. Min probleminde bile
hedefe bir eksi iþareti eklesem onu maksimizasyon olarak görebilirdim, ve
üst sýnýra bakabilirdim. Ýkizin türetisi için notlara bakabilirsiniz
[2]. Sonuçta þu minimizasyonu elde ediyorum,

$$
\min_{b \in \mathbb{R}^{|E|}, x \in \mathbb{R}^{|V|}} 
\sum _{(i,j) \in E} b_{ij} c_{ij} \quad \textrm{öyle ki}
$$

$$
b_{ij} \ge x_i - x_j
$$
$$
b_{ij}, x_i,x_j \in \{ 0,1\} \quad \forall i,j
$$

Elde ettiðimiz sonuc (hala ikize gelmedik) þunu söylüyor, elimdeki
düðümleri öyle iki gruba ayýrmak istiyorum ki (altta bir grup görülüyor,
renkli kýsým), bir gruptan diðer gruba geçen kapasitelerin, geçen
kenarlarýn kapasitelerinin toplamý minimal olsun.

\includegraphics[width=15em]{func_55_duality_03.png}

Bu arada üstteki program bir LP deðil, bir tamsayý programý (ýnteðer
program) çünkü eldeki düðümleri bir gruba ya da diðerine (0,1 deðerleri
üzerinden) atýyoruz, deðiþkenler ikisel, doðal olarak tam sayýlar. Þimdi
ikize geliyoruz, ana problemi ikiz üstteki tamsayý programýnýn gevþetilmiþ
(relaxation) hali. 0,1 tamsayýlarýný alýp onlarý 0 ile 1 arasýnda gidip
gelebilen reel deðiþkenler olarak tanýmlarsak bir LP elde ederiz. 

Yani ana / ikizlik ve üstteki gevþetme arasýndaki iliþkiler þöyle

maksimum akýþ deðeri $\le$ 
gevþetilmiþ minimum kesiþ $\le$ 
minimum kesiþin kapasitesi

Gevþetme ile minimum deðer daha azaldý, tamsayý programýný gevþetip
dýþbükey program haline getirince bunun olduðu biliniyor, kýsýtlama
kümesini geniþlettim, bu minimumu küçültecektir. 

Herhalde keþiþ kelimesinin nereden geldiði anlaþýlýyor þimdi, eðer elimde
bir makasla renkli bölgeye giden baðlantýlarý kessem, en az mýktarda akýþý
kesmiþ olurum, ve o renkli bölge içindeki akýþ en yüksek kapasitede olur.
Ve buradaki problemde güçlü ikizlik durumu olduðu için bu iki deðer
birbirine eþit! 

Þimdi LP ikizliðine farklý bir açýdan bakalým, ki bu açý oldukca faydalý
olacak. 








Örnek

Alttaki örnekte [3] bir maksimum akýþ çözümü görelim. Çizit ve her kenarýn
kapasiteleri görülüyor

\includegraphics[width=12em]{func_55_duality_04.png}
\includegraphics[width=12em]{func_55_duality_05.png}

\begin{minted}[fontsize=\footnotesize]{python}
from scipy.optimize import linprog
import numpy as np

A_ub = np.eye(5)
b_ub = np.array([1.,2.,2.,3.,1.])
A_eq = np.array([[1, 0, -1, -1, 0],
                 [0, 1, 1, 0, -1]])
b_eq = np.array([ 0, 0 ]);
f = np.array( [ 1, 1, 0, 0, 0 ])
res = linprog(-f, A_ub=A_ub, b_ub=b_ub, \
                 A_eq=A_eq, b_eq=b_eq)
print (np.round(res.x))
\end{minted}

\begin{verbatim}
[1. 1. 0. 1. 1.]
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
print (res.x.dot(f))
\end{minted}

\begin{verbatim}
1.9999999998438802
\end{verbatim}

Not: \verb!linprog! minimize etmeye ayarlý olduðu için hedefi eksi ile
çarptýk, yani maksimizasyon yaptýrmýþ olduk.

Maksimum akýþ 2.0 olarak bulundu. 

Optimize edilen $-f^T x$ dersek vektör $x$ içindeki öðeler
$e_1,e_2,e_3,e_4,e_5$, ve $f$ içinde $1,1,0,0,0$ var, yani aslýnda sadece
$e_1,e_2$'nin akýþ toplamýna bakmýþ oluyoruz. Bu normal, sebeplerinden önce
bahsetmiþtik. Bulunan sonuç $x^* = (1,1,0,1,1)$, ve $f^Tx^*$ çarpýmý ilk
iki öðeyi toplatýyor, ve 1+1 = 2, maksimum akýþ.

Eþitlik kýsýtlamalarý $A_{eq}$ ve $b_{eq}$ içinde, $A_{eq}x = b_{eq}$ için.
Sadece iki kýsýtlama var, bu kýsýtlamalardan ilki 1'e giren $e_1$ ile ondan
çýkan $e_3,e_4$'un eþit olmasý gerektiðini söylüyor, bu sebeple ilk
kýsýtlama $1,0,-1,-1,0$, ve ona tekabül eden $b_{eq}$ sýfýr deðerinde,
$e_1$ akýþý ile $e_3,e_4$ toplanýrsa sýfýr olsun demiþ oluyoruz. Ýkinci
kýsýtlama 2'ye giren iki akýþ $e_2,e_3$ ile çýkan $e_5$'i dengeliyor.

Eþitsizlik kýsýtlamalarý $A_{ub}x \le b_{ub}$. Burada kapasiteleri
kodluyoruz, her kenarýn kapasitesi belli, $e_1$ için 1, $e_2$ için 2, vs.
Ve optimal sonuç bulunuyor.

Not: bu problemi lineer program olarak kodlayabilmek çok þey
kazandýrdý. Diðer yandan üstteki problemi bilgisayar bilim baðlamýnda çözen
yaklaþýmlar da vardýr, hatta çizitin özel yapýsýndan faydalanarak bu
yaklaþýmlarýn bazýlarý oldukca hýzlý.

[devam edecek]

Kaynaklar

[1] Tibshirani, {\em Convex Optimization, Lecture Video 10}, 
\url{https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg}   

[2] Tibshirani, {\em Convex Optimization, Lecture Notes}, 
\url{https://www.stat.cmu.edu/~ryantibs/convexopt/}

[3] Zisserman, {\em C25 Optimization}, 
\url{http://www.robots.ox.ac.uk/~az/lectures/opt/}   

\end{document}




