<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"], cancelto: ["Extension","cancel"]
      });
    });
    </script>

  <title>Karush-Kuhn-Tucker (KKT) Şartları</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  
  
  
  
</head>
<body>
<h1 id="karush-kuhn-tucker-kkt-şartları">Karush-Kuhn-Tucker (KKT) Şartları</h1>
<p>KKT şartları birkaç basit kavramın bir araya gelmesiyle oluşan çok kuvvetli bir kavram. Bu şartlar 4 tane. Alttaki gibi genel bir problemle bağlantılılar,</p>
<p><span class="math display">\[
\min_x f(x) \quad \textrm{öyle ki}
\]</span> <span class="math display">\[
h_i(x) \le 0, \quad i=1,..,m
\]</span> <span class="math display">\[
l_j(x) = 0, \quad j=1,..,r
\]</span></p>
<p>Lagrangian'ı hatırlarsak,</p>
<p><span class="math display">\[
L(x,u,v) =  f(x) + 
\sum_{i=1}^{m} u_i \underbrace{h_i(x)}_{\le 0} + 
\sum_{i=1}^{r} v_i \underbrace{l_i(x)}_{=0}
\]</span></p>
<p>Problemin dışbükey olması mecbur değil.</p>
<p>Bu şartlar,</p>
<ol style="list-style-type: decimal">
<li>Durağanlık şartı</li>
</ol>
<p>Lagrangian'da <span class="math inline">\(u,v\)</span> sabitledim, ve <span class="math inline">\(x\)</span>'e göre Lagrangian'ın altgradyanını alırsam, 0 değeri bu altgradyan içinde olmalı.</p>
<p><span class="math display">\[
0 \in \partial_x \left(
f(x) + \sum_{i=1}^{m} u_i h_i(x) + \sum_{j=1}^{r} v_j l_j(x) 
\right)
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Tamamlayıcı Gevşeklik (Complementary Slackness)</li>
</ol>
<p><span class="math display">\[
u_i \cdot h_i(x) = 0 \quad \forall i
\]</span></p>
<p>Üstteki şart diyor ki ya <span class="math inline">\(h_i(x)\)</span> sıfır olmalı, yani <span class="math inline">\(i\)</span>'inci eşitsizlik sıkı olmalı, ya da ona tekabül eden ikiz değişken <span class="math inline">\(u_i\)</span> sıfır olmalı, yani eşitsizlik ya sıkı -eşitlik- ya da dikkate alınmamalı.</p>
<ol start="3" style="list-style-type: decimal">
<li>Ana Olurluk</li>
</ol>
<p><span class="math display">\[
h_i(x) \le 0, \quad l_j(x) = 0 \quad \forall i,j
\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li>İkiz Olurluğu</li>
</ol>
<p><span class="math display">\[
u_i \ge 0, \quad \forall i
\]</span></p>
<p>Optimallik için <span class="math inline">\(x,u,v\)</span> üstteki 4 şartı yerine getirmeli, genel bağlamda bu o <span class="math inline">\(x\)</span>'in ana problemi, <span class="math inline">\(u,v\)</span>'nin ikiz problemi çözmesi anlamına geliyor.</p>
<p>İspatlayalım. Önce ters yönden gelerek bir ispat, diyelim ki elimde ana ve ikiz çözümler var. Eğer o &quot;çözüm varsa, oradan KKT şartları meydana çıkmalı'' ispatını görelim. Bu yöne &quot;gereklilik'' (necessary) denebilir. Diyelim ki <span class="math inline">\(x^\ast\)</span>, ve <span class="math inline">\(u^\ast,v^\ast\)</span> ana ve ikiz çözümleri var, ve ikizlik boşluğu sıfır (yani güçlü ikizlik aktif, Slater şartını hatırlarsak). O zaman</p>
<p><span class="math display">\[
f(x^\ast) = g(u^\ast,v^\ast)
\]</span></p>
<p>Tanım itibariyle, her <span class="math inline">\(u,v\)</span> için <span class="math inline">\(g(u,v)\)</span> fonksiyou Lagrangian'ın <span class="math inline">\(x\)</span> üzerinden minimumu. Üsttekinden hareketle ve <span class="math inline">\(u,v\)</span> için <span class="math inline">\(u^\ast,v^\ast\)</span> kullanırsak,</p>
<p><span class="math display">\[
= \min_x f(x) + \sum_{i=1}^{m} u_i^\ast h_i(x) + \sum_{j=1}^{r} v_j^\ast l_j(x) 
\]</span></p>
<p>Üstte minimum buluyorum yani <span class="math inline">\(x\)</span> üzerinden üstteki Lagrangian'ı <span class="math inline">\(x^\ast\)</span>'deki halinden daha fazla ufaltmam mümkün değil,</p>
<p><span class="math display">\[
\le f(x^\ast) + \sum_{i=1}^{m} u_i{^\ast} h_i(x^\ast) + \sum_{j=1}^{r} v_j{^\ast} l_j(x^\ast) 
\qquad (1)
\]</span></p>
<p>Devam edersek, <span class="math inline">\(u_i^\ast\)</span> olurlu, o zaman üstteki ortadaki terim <span class="math inline">\(\ge 0\)</span>, <span class="math inline">\(v_i^\ast\)</span> olurlu o zaman üçüncü terim sıfır. Bu demektir ki üstteki ifade <span class="math inline">\(f(x^\ast)\)</span>'den daha az olmalı.</p>
<p><span class="math display">\[
\le f(x^\ast) 
\qquad (2)
\]</span></p>
<p>Sonuç olarak</p>
<p><span class="math display">\[
f(x^\ast) \le f(x^\ast*)
\]</span></p>
<p>elde ettik, o zaman üstteki ifade aslında eşitsizlik değil bir eşitlik çünkü eşitsizliğin iki tarafında aynı şey var.</p>
<p>Eşitsizliklerin eşitlik olması ne anlama gelir? Demek ki <span class="math inline">\(x^\ast\)</span> Lagrangian'ı <span class="math inline">\(u^\ast,v^\ast\)</span> noktasında minimize edecektir. Durağanlık bu demek zaten değil mi? <span class="math inline">\(x\)</span>'e göre Lagrangian'ın altgradyanını aldım ve bu sıfıra eşit. Ayrıca tamamlayan gevşeklik şartı da ispatlanmış oluyor, (1) ile (2) eşit olmalıysa, ve (1)'deki 3. terimin sıfır olduğunu biliyoruz, 2. terimdeki tamamı pozitif olan toplam öğeleride sıfır olmalı çünkü başka türlü (2)'ye eşitliği elde edemeyiz. Eh bu durum da tamamlayan gevşeklik şartı değil midir?</p>
<p>Ana-ikiz olurluğunu zaten bedava elde ettik. Elimizde bir çözüm varsa onlar ana-ikiz olurlu olmalı.</p>
<p>Yani ispatlamış olduk ki eğer elimizde ana-ikiz boşluğu olmayan bir çözüm varsa, <span class="math inline">\(x^\ast,u^\ast,v^\ast\)</span> çözüm üçlüsü KKT koşullarına uymaktadır. KKT koşularının güçlü ikizlik durumunda şart olduğunu göstermiş olduk.</p>
<p>Diğer yönden ispat etmeye uğraşalım.</p>
<p>Elimizde KKT şartlarını tatmin eden bir <span class="math inline">\(x^\ast,u^\ast,v^\ast\)</span> üçlüsü olduğunu düşünelim, ve bu üçlünün optimal olması gerektiğini ispat edelim, yani <span class="math inline">\(x^\ast\)</span>'in ana <span class="math inline">\(u^\ast,v^\ast\)</span>'nin ikiz problem için optimal olması gerektiğini.. Eğer <span class="math inline">\(x^\ast,u^\ast,v^\ast\)</span> KKT şartlarına uygunsa, durağanlığa göre</p>
<p><span class="math display">\[
g(u^\ast,v^\ast) = f(x^\ast) + \sum_{i=1}^{m} u_i{^\ast} h_i(x^\ast) + \sum_{j=1}^{r} v_j{^\ast} l_j(x^\ast) 
\qquad (3)
\]</span></p>
<p>Bu tabii <span class="math inline">\(g\)</span> tanımı ile bağlı,</p>
<p><span class="math display">\[
g(u^\ast,v^\ast) = \min_x L(x,u^\ast,v^\ast)
\]</span></p>
<p>ve durağanlıkla</p>
<p><span class="math display">\[
= \min_x L(x^\ast,u^\ast,v^\ast)
\]</span></p>
<p>böylece üç üstteki tanım ortaya çıkıyor.</p>
<ol start="3" style="list-style-type: decimal">
<li>içindeki ikinci terimde tamamlayıcı gevşekliği uygularsak toplamdaki her öge <span class="math inline">\(x^\ast\)</span> için sıfır, toplam sıfır, ikinci terim tamamen sıfır.</li>
</ol>
<p>KKT koşullarından bir diğeri olurluk, o zaman (3)'teki üçüncü terimde her toplam öğesi sıfır, toplam sıfır. Geriye tek kalan</p>
<p><span class="math display">\[
g(u^\ast,v^\ast) = f(x^\ast) + 
\cancel{\sum_{i=1}^{m} u_i{^\ast} h_i(x^\ast)} + 
\cancel{\sum_{j=1}^{r} v_j{^\ast} l_j(x^\ast)}
\]</span></p>
<p><span class="math display">\[
= f(x^\ast)
\]</span></p>
<p>Eğer <span class="math inline">\(g(u^\ast,v^\ast) = f(x^\ast)\)</span> ise o zaman ana ve ikiz kriter arasında ikizlik boşluğu yoktur demektir, ve daha önce gördüğümüz gibi bu elimizdekinin bir çözüm olduğunun işaretidir.</p>
<p>Yani birkaç farklı yönden gelerek ispatladık ki <span class="math inline">\(x^\ast\)</span> ve <span class="math inline">\(u^\ast,v^\ast\)</span> KKT koşullarına uyuyorsa, o zaman elimizdekiler optimal ana ve ikiz çözümleridir. KKT koşulları her zaman yeterlidir. Dikkat edilirse dışbükeylikten hiç bahsetmedik, KKT yeterli (sufficient), onlara uygunluk varsa optimal ana ve ikiz çözüme erişmişiz demektir. Gereklilik (necessary) durumu eğer güçlü dışbükeylik varsa, elimizdeki çözüm KKT koşullarına da uymaya mecbur. Biraz söz cambazlığı gibi gelebilir ama tanımların net olması, ve ilerideki teorilere faydası açısından bu iyi.</p>
<p>Soru</p>
<p>Eğer KKT koşullarını tatmin etmek optimallik için yeterliyse dünyadaki her problemi KKT üzerinde rahatça çözebilir miyim?</p>
<p>Hayır çünkü 1. KKT şartı, durağanlık şartıyla problem çıkabilir. Pürüzsüz bir problem için durağanlık için <span class="math inline">\(f\)</span> ve <span class="math inline">\(h_i,l_i\)</span>'in gradyanlarını almam yeter, sıfıra eşitlerim vs. Bir de dışbükeylik varsa tipik olarak altgradyanı yazmak basittir. Sonucu bulmak her zaman kolay olmayabilir ama en azından durağanlığı formülize etmek kolaydır. Fakat bazı fonksiyonlarda dışbükeylik yoksa altgradyanları hesaplamanın zorluğu ötesinde bazen altgradyan olmayabilir bile. Genelde pürüzsüz durumlarda KKT koşullarını kullanmanın zor tarafı budur.</p>
<p>Bu sebeple formel bir uyarıyı slaytlara koyduk, &quot;eğer <span class="math inline">\(f\)</span> dışbükey değilse türevi alınabilir bir <span class="math inline">\(f\)</span> için bile direk <span class="math inline">\(\partial f = \{\nabla f(x)\}\)</span> diyemeyiz''.</p>
<p>Eğer ana problemde hiçbir kısıtlama olmasaydı o zaman 2. 3. ve 4. KKT şartları yokoluyor bu normal çünkü ikiz değişken olmayacak, 1. şarttaki 2. ve 3. terim yokolur, sadece altgradyanın sıfırı içerme şartı geriye kalıyor. Bazen bilimcilerin bu tür problemlerde salt altgradyan optimalliği kullanıp &quot;KKT koşulları kullandım'' dediğini duyabilirsiniz, ben bile dalgınlıkla bunu söyleyebiliyorum bazen. Fonksiyon var, altgradyanını alıp sıfıra eşitliyorum, bu &quot;KKT koşulu'' diyorum. Teknik olarak doğru tabii, sadece KKT'nin çok basit bir hali bu.</p>
<p>Örnek</p>
<p>Eşitlik şartları olan karesel bir fonksiyonun minimizasyonuna bakalım.</p>
<p><span class="math display">\[
\min_x \frac{1}{2} x^T Q x + c^T x \quad \textrm{öyle ki}
\]</span> <span class="math display">\[
Ax = 0
\]</span></p>
<p><span class="math inline">\(Q \succ 0\)</span> olacak, yani <span class="math inline">\(Q\)</span> pozitif yarı-kesin, o zaman üstteki problem dışbükey. Eşitsizlik şartı yok.</p>
<p>KKT şartlarını yazalım. Lagrangian nedir?</p>
<p><span class="math display">\[
L(x,u) = \frac{1}{2} x^T Q x + c^T x + u^T A x
\]</span></p>
<p>Durağanlık için üsttekinin gradyanını alıp sıfıra eşitlerim,</p>
<p><span class="math display">\[
Qx + c + A^T u = 0
\]</span></p>
<p>Tamamlayıcı gevşeklik</p>
<p>(Boş, çünkü eşitsizlik şartları yok)</p>
<p>Ana-ikiz olurluk</p>
<p>İkiz olurluk boş, çünkü eşitsizlik yok, yani <span class="math inline">\(u\)</span>'nin pozitif olma şartı yok. Ana olurluk ise</p>
<p><span class="math display">\[
Ax = 0
\]</span></p>
<p>Biliyoruz ki üstteki iki şartı tatmin edersem <span class="math inline">\(x\)</span> ana, <span class="math inline">\(u\)</span> ikiz optimal çözüm olacak.</p>
<p>Güzel değil mi? Hatta bu lineer bir sistem olarak yazılabilir,</p>
<p><span class="math display">\[
\left[\begin{array}{ccc}
Q &amp; A^T \\ A &amp; 0
\end{array}\right]
\left[\begin{array}{c}
x \\ u
\end{array}\right] =
\left[\begin{array}{r}
-c \\ 0
\end{array}\right] 
\]</span></p>
<p>Eğer üstteki sistemi <span class="math inline">\(x,u\)</span> bulmak için çözersem, optimal noktaları bulabilirim. Eğer matris tersi alınabilir ise tersini alırım, eşitliğin sağındaki ifade ile çarparım, bu bana ana-ikiz sonucu verir.</p>
<p>Üstteki matrise bazen KKT matrisi deniyor, KKT koşullarını kullanarak oluşturulduğu için.</p>
<p>[atlandı, su doldurma problemi, SVM]</p>
<p>Ekler</p>
<p>Örnek</p>
<p>Şimdi [2]'den alınan bir örneği görelim.</p>
<p><span class="math display">\[
\min_{x_1,x_2} x_1^2 + x_2^2 \quad \textrm{öyle ki}
\]</span> <span class="math display">\[
x_1 + x_2 = 5
\]</span></p>
<p>Burada bir eşitlikle kısıtlanmış QP (equality constrained QP) var ve biraz önce gördüğümüz KKT matrisini oluşturarak onu tek adımda çözebiliriz. Kriter ve kısıtlama matris formunda şöyle, <span class="math inline">\(x = (x_1,x_2)\)</span> alırsak,</p>
<p><span class="math display">\[
f(x) = \frac{1}{2} x^T 
\underbrace{
\left[\begin{array}{cc}
2 &amp; 0 \\ 0 &amp; 2
\end{array}\right]}_{Q} x + 
\left[\begin{array}{cc}
0 &amp; 0
\end{array}\right]^T x
\]</span> <span class="math display">\[
\underbrace{
\left[\begin{array}{cc}
1 &amp; 1
\end{array}\right]}_{A}
\left[\begin{array}{c}
x_2 \\ x_2
\end{array}\right] = 5
\]</span></p>
<p>(Sıfır vektörü var çünkü <span class="math inline">\(x_1^2,x_2^2\)</span> içeren terimler var ama <span class="math inline">\(x_1,x_2\)</span> içeren terimler yok)</p>
<p>KKT matrisini şöyle oluştururuz,</p>
<p><span class="math display">\[
\left[\begin{array}{ccc}
Q &amp; A^T \\ A &amp; 0
\end{array}\right]
\left[\begin{array}{c}
x \\ u
\end{array}\right] =
\left[\begin{array}{r}
-c \\ b
\end{array}\right] 
\]</span></p>
<p><span class="math display">\[
\left[\begin{array}{ccc}
2 &amp; 0 &amp; 1 \\
0 &amp; 2 &amp; 1 \\
1 &amp; 1 &amp; 0
\end{array}\right]
\cdot
\left[\begin{array}{c}
x_1 \\ x_2 \\ u
\end{array}\right] = 
\left[\begin{array}{c}
0 \\ 0 \\ 5
\end{array}\right] 
\]</span></p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> numpy.linalg <span class="im">as</span> lin
X <span class="op">=</span> np.array([[<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>],[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>],[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>]]) 
a <span class="op">=</span> np.array([[<span class="dv">0</span>],[<span class="dv">0</span>],[<span class="dv">5</span>]])
<span class="bu">print</span> (lin.solve(X,a))</code></pre></div>
<pre><code>[[ 2.5]
 [ 2.5]
 [-5. ]]</code></pre>
<p>Doğrulamak için paket ile çözelim,</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">from</span> cvxopt <span class="im">import</span> matrix
<span class="im">from</span> cvxopt <span class="im">import</span> solvers
Q <span class="op">=</span> matrix([ [<span class="fl">2.0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="fl">2.0</span>] ])
p <span class="op">=</span> matrix([<span class="fl">0.0</span>, <span class="fl">0.0</span>])
G <span class="op">=</span> matrix([[<span class="fl">0.0</span>,<span class="fl">0.0</span>],[<span class="fl">0.0</span>,<span class="fl">0.0</span>]])
h <span class="op">=</span> matrix([<span class="fl">0.0</span>,<span class="fl">0.0</span>])
A <span class="op">=</span> matrix([<span class="fl">1.0</span>, <span class="fl">1.0</span>], (<span class="dv">1</span>,<span class="dv">2</span>))
b <span class="op">=</span> matrix(<span class="fl">5.0</span>)
sol<span class="op">=</span>solvers.qp(Q, p, G, h, A, b)
<span class="bu">print</span> (sol[<span class="st">&#39;x&#39;</span>])</code></pre></div>
<pre><code>     pcost       dcost       gap    pres   dres
 0:  1.2500e+01  1.2500e+01  2e+00  1e+00  1e-15
 1:  1.2500e+01  1.2500e+01  2e-02  1e-02  0e+00
 2:  1.2500e+01  1.2500e+01  2e-04  1e-04  0e+00
 3:  1.2500e+01  1.2500e+01  2e-06  1e-06  0e+00
 4:  1.2500e+01  1.2500e+01  2e-08  1e-08  0e+00
Optimal solution found.
[ 2.50e+00]
[ 2.50e+00]</code></pre>
<p>Ekler</p>
<p>Soru</p>
<p>Eğer KKT şartını eşitlik sınırlanmış QP (bilahere LP) çözmek için kullanabiliyorsam, ve mesela LP diyelim, her eşitsizlik içeren problemi standardizasyon ile eşitlikle sınırlı probleme çevirebiliyorsam, KKT matrisi ile her türlü LP'yi çözemez miyim? Niye farklı metotlara giriş yapmak gerekiyor?</p>
<p>Cevap</p>
<p>Standardizasyon sonrası hala elimizde pozitiflik sınırlamaları var, ki bunlar da birer eşitsizlik sınırı aslında. KKT matrisi çözmek bu eşitsizlikleri tatmin etmez, basit bir matris tersi alıyoruz, elimize geçen değişkenlerin pozitif kalma zorunluluğunu bu metot ile zorlayamayız.</p>
<p>Kaynaklar</p>
<p>[1] Tibshirani, <em>Convex Optimization, Lecture Video 12</em>, <a href="https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg" class="uri">https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg</a></p>
<p>[2] Lendek, <em>Optimization Lecture, Quadratic Programming</em> <a href="http://www.lendek.net/teaching/opt_en/" class="uri">http://www.lendek.net/teaching/opt_en/</a></p>
</body>
</html>
