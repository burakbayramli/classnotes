\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Ders 16

Önceki dersi hatýrlarsak en sonda yansýtma matrisi diye bir matrisle
bitirdik. Bu konunun bir daha üzerinden geçelim. Sihirli formülümüz 

$$ P = A(A^TA)^{-1}A^T $$

ne yapýyordu? Yansýtma matrisi $P$, $b$'yi alýp $Pb$ çarpýmý ile onun
$A$'nin kolon uzayýndaki izdüþümünü hesaplýyordu. Diyelim ki $b$ zaten
kolon uzayýnda, o zaman $P$ ne yapar? Hiçbir þey. Yani $Pb=b$. ``Bu hiçbir
þey'' cevabý üstteki formülden doðal olarak çýkmalý. Peki eðer $b$, $A$'nin
kolon uzayýna tam dik olsaydý? Yani üç boyutta düþünsek, $A$ bir düzlem,
$b$ onun üzerinden yukarý tam dik bir þekilde fýrlamýþ bir vektör. Bu
vektörün alttaki düzlemde yansýmasý nedir?  Sýfýr. Yani $Pb=0$. Bu iki
durum oldukça sýradýþý tabii ki, ama iyi zihin egzersizi olmalarý açýsýndan
onlardan bahsettim. Çoðu durumda bir yansýma vardýr.

Cebirsel olarak $Pb=0$ durumuna inceleyelim; eðer $b$, $A$ kolon uzayýna
dik ise o zaman bu $A^T$'nin sýfýr uzayýndadýr. Bu durumda $Pb$, 

$$ Pb =  A(A^TA)^{-1}A^T b =A(A^TA)^{-1}\cancelto{0}{A^T b} = 0  $$

olur çünkü eðer $b$ $A^T$'nin sýfýr uzayýnda ise $A^Tb=0$. 

Öteki durumda, yani $b$'nin $A$'nin kolon uzayýnda olduðu durumu þöyle
türetiriz; $A$'nin kolon uzayýnda olmak ne demektir? Bu $Ax$ formundan
ibaret, $Ax$, $A$'nin kolon uzayýnda çünkü $x$ $A$'nin kolonlarýný kombine
ediyor. Bunu artýk pat diye görüyor olmamýz lazým, hatta bir ufak sýnava
bile bu soruyu dahil edebilirim çünkü sürekli bahsettiðimiz bir þey. Neyse,
bu $b=Ax$ kombinasyonunu formüle koyalým,

$$ Pb =  A(A^TA)^{-1}A^TAx = Ax = b$$

Bu nasýl oldu? $(A^TA)^{-1}$ ile $(A^TA)$ yanyana geldi, bu iki ifade birbirinin
tersidir, o zaman çarpýmlarý $I$ olur, geri kalanlar $Ax$, ki o da $b$'ye eþit. 

Resmedersek, 

\includegraphics[height=4cm]{16_6.png}

Elimizde verili ``tipik vektör'' $b$ var, tipik çünkü üstteki sýradýþý
durumlarda deðil, ve bu vektörün kolon uzayýna [resimde 'col space' olarak
yazýlý] izdüþümü $P$ ile, $A^T$'nin sýfýr uzayýna izdüþümü ise $e$
ile. $P+e = b$. Bu yansýtmalar $Pb$ ve hata için ona dik olan uzaya
izdüþümü $(I-P)b$. Not: $P$ yansýtma ise $I-P$ de yansýtmadýr, $P$ simetrik
ise $I-P$ de simetriktir, $P^2=P$ ise $(I-P)^2=I-P$. Cebir sadece resimde
görülenleri tarif ediyor.

Böylece önceki dersin üzerinden geçmiþ olduk, iyi oldu, çünkü baþtaki
formülü birden fazla kez görmenizi istedim. Þimdi bu formülü nasýl
kulanacaðýmýza gelelim.

En iyi düz çizgi bulma probleminden devam ediyoruz. Diyelim ki elimizde
þöyle veriler var, 

\includegraphics[height=4cm]{16_1.png}

Eðer veride sadece ilk iki nokta olsaydý onlar bir düz çizgi oluþtururdu,
resimde öyle duruyorlarr, ama üçüncü nokta olasý bir çizginin kesinlikle
dýþýnda. Bu noktalar için en iyi düz çizgi $y=C+Dt$'yi arýyorum, ki bu
çizgi kabaca altta görüldüðü gibi birþey olacak.

\includegraphics[height=4cm]{16_2.png}

Bu ideal çizginin tüm noktalardan geçmesi mümkün deðil çünkü hiçbir düz
çizgi tüm noktalardan geçemez. Yapmaya uðraþacaðýmýz hata miktarýný en aza
indirgeyerek bir çizgi bulmak. 

Her nokta bize bir denklem veriyor (her $t$ için farklý bir denklem), bu
denklemler, $t=1,2,3$ için,

$$ C + D = 1 $$
$$ C + 2D = 2 $$
$$ C + 3D = 2 $$

Ve bu denklem sisteminin çözümü yok. Ama ``olabilecek en iyi çözümü''
var. En iyi ile neyi kastetiðimi göstereyim. Matris formunda,

$$ 
\left[\begin{array}{rrr}
1 & 1 \\
1 & 2 \\
1 & 3
\end{array}\right]
\left[\begin{array}{rrr}
C \\
D
\end{array}\right]
=
\left[\begin{array}{rrr}
1 \\
2 \\
2 
\end{array}\right]
 $$

$A$ için elimde iki baðýmsýz kolon var, yani kolon uzayý için elimde bir
baz var, ama eþitliðin saðýndaki vektör $b$ bu kolon uzayý içinde deðil. O
zaman ``en iyi'' olan nedir? Bu çözüm, her ne ise, 1. 2. ve 3. denkleme
verildiðinde $b$ hesabý için bir hata yapacaklar, bu hatalarýn karelerini
alýp toplarsam, bir genel hata elde etmiþ olurum. Amacým, 

Minimize Et $||Ax-b||^2 = ||e||^2 = e_1^2+e_2^2+e_3^2$

Hata ``vektörünün'' uzunluðunu aldýk, çünkü hatanýn yönü ile deðil
büyüklüðü ile ilgileniyoruz, vektör büyüklüðü de hep pozitif bir sayý
olacak. Ayrýca matematiksel kolaylýk saðlamasý açýsýndan uzunluðun karesini
aldýk (kolaylýðýn sebebini anlamak için bkz [3]).

Galiba söylemek istediðim þu, olaya iki tür bakýþ açýsý var. Birincisi 3
nokta ve çizgi bakýþý. Bu resimde, hatalar nerede, farazi düzlem
üzerinde gösterirsem [yeþil ufak çizgiler],

\includegraphics[height=4cm]{16_3.png}

Genel hata nedir? Tüm bu hatalarý alýp toplarsak, $e_1^2 + e_2^2 +
e_3^2$. Minimize etmeye çalýþtýðým bu. Bu iþlem, bu arada, Ýstatistiðin
önemli bir kýsmýný oluþturur, ki bu iþleme regresyon denir, bu örnekte
lineer regresyon. Veriye düz çizgi uydurmak, ayrýca, pek çok bilim dalýnýn
en önemli araçlarýndan.

Bazý istatistikçiler hata karesi alýnmasý hakkýnda rahatsýz olabilirler /
tetikte olurlar, çünkü diyelim ki 4. veri noktasý var elimizde ve bu nokta
diðerlerinden müthiþ uzakta,

\includegraphics[height=4cm]{16_4.png}

Bu veri noktasý lineer çizgi uyumunu tamamen deðiþtirirdi çünkü onun hata
karesi aþýrý büyük olurdu. Ýstatistikçiler bu gibi veri noktalarýna aykýrý
deðer (outlier) derler, ve onlarý saptamak / bilmek isterler, belki bu
noktalar için hata karesi almayacaklardýr, ya da regresyona dahil bile
etmeyeceklerdir. Bu da mümkün, çünkü sonuçta aykýrý deðer bir hatalý ölçüm
durumuna iþaret edebilir. Neyse, biz bu örnekte eldeki 3 veri noktasý ile
iþlem yapacaðýz.

Ýki resim demiþtik, biri üstteki minimizasyon, denklemler, hatalar. Bu
resimde çizgi {\em üzerinde} olan noktalar, ki bu noktalara $P_1,P_2,P_3$
diyeyim, nedir? Bizim verili olan $b_1,b_2,b_3$ noktalarýmýz da var, onlarý
da gösterelim,

\includegraphics[height=4cm]{16_5.png}

$b$ noktalarý çizgi üzerinde deðil muhakkak, zaten bunun için bu çizgi
uydurma iþine girdik. Eðer denklemde $b$ yerine $P$ noktalarý kullansaydým
ne olurdu? Birazdan $P$'lerin ne olduðunu da bulacaðým, ama ne olurdu? Bu
denklemi çözebilirdim o zaman, çünkü $P$, $A$'nin kolon uzayýndadýr.

Ýkinci resim ise ilk baþta gösterdiðimiz. 

Artýk $P$'yi hesaplayalým! Problem alttakileri bulmak

$$\hat{x} = \left[\begin{array}{r}
\hat{C} \\ \hat{D}
\end{array}\right]
, 
P
$$

Þapka iþareti bu deðiþkenlerin asýllarýnýn ``tahmin edilmiþ'' versiyonu
olduklarýný göstermek için kullanýldý. Formül neydi? 

$$ A^T A\hat{x} = A^Tb $$

Üstteki formül bu arada, kanýmca, Ýstatistik ve genel olarak tahmin
(estimation) alanýndaki en önemli formüldür. Bu formül hata, gürültü, vs
var ise, ne zaman bir uydurma (fitting) iþlemi var ise kullanýlan ilk
formüldür.

Devam edelim, $A^TA,A^Tb$ hesaplarýný yapalým þimdi,

$$ 
A^TA = 
\left[\begin{array}{rrr}
1 & 1 & 1\\
1 & 2 & 3\\
\end{array}\right]
\left[\begin{array}{rr}
1 & 1 \\
1 & 2 \\
1 & 3
\end{array}\right] =
\left[\begin{array}{rr}
3 & 6 \\
6 & 14
\end{array}\right] 
 $$

$$ A^Tb = 
\left[\begin{array}{rrr}
1 & 1 & 1\\
1 & 2 & 3\\
\end{array}\right]
\left[\begin{array}{r}
1 \\
2 \\
2
\end{array}\right] =
\left[\begin{array}{r}
5 \\
11 
\end{array}\right]
 $$

Sonuç matrisinin simetrik, ve tersi alýnabilir olmasýný
beklerim. Ayrýca.. tüm derslerimizin sonuna yaklaþýnca üsttekinin ``pozitif
kesin (positive definite) olmasýný beklerim'' beyanýný da yapacaðým. Bu
konuya daha gelmedik. 

Denklemleri yazalým þimdi, ki bu formüllere ``normal formüller (normal
equations)'' ismi de veriliyor,

$$ 3C + 6D = 5 $$

$$ 6C + 14D = 11 $$

Ýþte çözüm bu. Þimdi bu ayný sonucu minimize ifadesinden baþlayarak
Calculus kullanarak ta bulmak istiyorum, $||e||^2$ ifadesinin açýlmýþ hali,
þöyle olur, 

$$ (C+D-1)^2 + (C+2D-2)^2 + (C+3D-2)^2 $$

Burada ilk hata terimi ilk denklem $C+D$'nin ne kadar hata yaptýðýdýr, 2.,
3. ayný þekilde. Üstteki ifadeyi minimize etmek istiyoruz. Lineer Cebir iki
üstte bize bu minimizasyon sonucunu verdi. Fakat Calculus ta
kullanabiliriz, iki deðiþkenimiz var, $C,D$, ve minimum noktasýný arýyoruz.
Bunun için ne yaparýz, kýsmi türev (partial derivative) alýrýz deðil mi? Bu
türevleri alýnca da aynen iki üstteki formüllerin çýktýðýný görürdük [bu
konu hakkýnda daha fazla detay için bkz. {\em Çok Deðiþkenli Calculus} ders
notlarý].

Neyse, artýk iki üstteki sistemi çözmenin zamaný; eliminasyon yaparak
sonucu bulurum, $D=1/2,C=2/3$, bu demektir ki uydurdurduðumuz çizgi 
$y=2/3+1/2t$ formülüne sahip.

Hatalarý hesaplarsak $e_1=-1/6,e_2=2/6,e_3=-1/6$, bu $e$ vektörü. 

$P$ vektörünü hesaplarsak her $t=1,2,3$ için $y=2/3+1/2t$, yani
$p_1=7/6,p_2=5/3,13/6$. 

$P+e$ toplamý $b$ sonucunu vermeli demiþtik, kontrol edelim,

$$ 
\left[\begin{array}{r}
1 \\ 1 \\ 2
\end{array}\right]
=
\underbrace{
\left[\begin{array}{r}
7/6 \\ 5/3 \\ 13/6
\end{array}\right] 
}_{P}
+ 
\underbrace{
\left[\begin{array}{r}
-1/6 \\ 2/6 \\ -1/6
\end{array}\right]
}_{e}
 $$

Bildiðimiz diðer þeyler.. $P \perp e$. $P$, $A$'nin kolon uzayýnda bunu zaten
biliyoruz. Ayrýca $e \perp C(A)$.

Son beyaný kontrol edelim, $A$'nin kolonlarýndan birini alalým, mesela
$\left[\begin{array}{ccc} 1&1&1 \end{array}\right]^T$, bu $e$'ye dik midir?  $e$
ile noktasal çarpýmýný alýnca sonuç $=-1/6+2/6-1/6=0$. Evet dik.  Diðer vektör
$\left[\begin{array}{ccc} 1&2&3 \end{array}\right]^T$ için durum ayný.

Ýki resim umarým artýk iyice belirginleþmiþtir. Biri vektörler, matrisler
resmi, diðeri noktalar, çizgiler resmi. Fakat bu iki resim de aslýnda ayný
þeyi anlatýyorlar. Ýlk resimde $C,D$ ortaya bile çýkmadý, ama sonuç ayný.

$A^TA$ Hakkýnda

Bu noktada bir pürüze deðinmek isterim. Þu teoriyi ortaya atýyorum: ``Eðer
$A$'nin kolonlarý baðýmsýz ise, o zaman $A^TA$ tersi alýnabilir bir
matristir''.

En Az Karelerin kullandýðý bir durum bu. Bu ifadeyi ispatlamak istiyorum
þimdi, bu bir, iki, ya tersi alýnabilir deðil ise? O zaman ne yapacaðýz?
Önce ispat. 

Farzedelim ki $A^TAx=0$ (Unutmayalým, ispat amacýmýz $A^TA$'nin tersi
alýnabilir olduðunu göstermek, ve bu durumda $A^TAx=0$ dedim, çünkü o sýfýr
sonucunu verecek tek $x$'in $x=0$ olduðunu göstermeye uðraþacaðým, çünkü
tersi alýnabilir {\em olmasaydý} o zaman sýfýr uzayýnda sýfýr haricinde
baþka deðerler de olurdu, yani $x$ için üstteki denklemde sýfýr haricinde
de deðerler gelebilirdi).

Her iki tarafý $x^T$ ile soldan çarpalým, 

$$ x^TA^TAx = 0 $$

Parantezleri koyarsam, 

$$ (Ax)^T(Ax) = 0 $$

$Ax$ bir vektördür deðil mi? Diyelim $y=Ax$. Eh o zaman $y^Ty$ bize ne
verirdi? Bir uzunluk deðeri, yani tek skalar bir deðer. Bu skalar deðer
sýfýr ise o zaman $y$, ya da $Ax$ ifadesi sýfýrdýr. Baþka bir alternatif
yok.

Þimdi bu ek bilgiyle teoriye dönelim, ``eðer $A$'nin kolonlarý baðýmsýz ise
ve $Ax=0$ ise'' ... buradan devam ediyoruz, varýlacak tek bir sonuç var, o
zaman $x=0$ demektir. Hedefimize ulaþtýk. 

Bir ilginç bilgi daha: hangi durumda kolonlar {\em kesinlikle} baðýmsýzdýr?
Eðer o kolonlar birim vektörlerden oluþuyor ve birbirlerine dikgen ise.

\includegraphics[height=4cm]{16_7.png}

Üstteki durum mesela, $x,y,z$ eksenlerindeki vektörler, (dikkat, birim,
birbirine dikgen vektörlerin illa eksenler üzerinde olmasý gerekmez). Bu
durumda $A^TA$ çok güzel çýkýyor, birim (identity) matrisi. 

Not: Birbirine dikgen birim vektörlerine birimdik (orthonormal) vektörler
adý veriliyor. 

En sevdiðimiz birimdik vektör örneði 

\includegraphics[height=4cm]{16_8.png}

Bu vektörler çok iyi çünkü boylarý 1'i geçmiyor ($\cos,\sin$ tanýmý
itibariyle), ve vektörler birbirlerine bariz olarak dik. 

Sonraki dersteki amacýmýz niye birimdik vektörlerin çok iyi olduðunu görmek
ve sonra, doðru bir baz seçerek vektörleri birimdik hale getirmeyi
öðrenmek. 

Ek Konu

QR ile En Az Kareler 

Þimdi [1, sf 236], [2], ve [3, sf 346] kaynaklarýný baz alarak bazý ekler
yapalým. En Az Kareler için gereken $A^TA$ hesabý, ve onun tersinin
alýnmasý oldukça yük getirebilecek bir iþlemdir ve $A^TA$ aþýrý sayý
büyümesine sebep olabilir. Bu hesaplardan kaçýnmak istiyorsak, þu bilgiyi
kullanabiliriz. 

Her $A$ matrisinin bir $QR$ ayrýþtýrmasý vardýr, yani 

$$ A = QR $$

ki $Q$ $m \times n$ boyutlu birimdik (orthonormal) bir matris, $R$ ise $n
\times n$ boyutlarýndaki üst üçgensel bir matris. $QR$ konusunu ileriki
derslerde Strang hoca iþleyecek. Ama bunun iþlediðini farzederek þimdiden
bazý sayýsal konular için kullanabiliriz.

En Az Kareler formülü

$$ 
A^TA \hat{x} = A^Tb 
\mlabel{1} 
$$

için gereken $A^TA$'yi þu halde yazabiliriz,

$$ A^TA = (QR)^TQR = R^TQ^TQR = R^TR $$

(1) içine koyunca

$$ R^TR \hat{x} = R^TQ^Tb $$

$$ R \hat{x} = Q^Tb $$

ya da 

$$ \hat{x} = R^{-1}Q^Tb $$

Böylece ters alma iþlemi daha ufak olan $R$ üzerinde gerçekleþtiriliyor. 

\begin{minted}[fontsize=\footnotesize]{python}
import numpy.linalg as lin
A = np.array([[1,1],[1,2],[1,3]])
b = np.array([[1],[2],[2]])
q,r = lin.qr(A)
print q.shape, '\n', r
print 'qr'
print np.dot( np.dot(lin.inv(r),q.T), b )
print 'kutuphane cagrisi lstsq'
print lin.lstsq(A,b)[0]
\end{minted}

\begin{verbatim}
(3, 2) 
[[-1.73205081 -3.46410162]
 [ 0.         -1.41421356]]
qr
[[ 0.66666667]
 [ 0.5       ]]
kutuphane cagrisi lstsq
[[ 0.66666667]
 [ 0.5       ]]
\end{verbatim}

Bazý Ýspatlar

$R$'nin tersi alýnabilir olduðunu nereden biliyorum? Çünkü $A$'nin
kolonlarýnýn baðýmsýz olduðunu farzettim, $A$ kolonlarý baðýmsýz ise
$R$ tersi alýnabilir bir matristir. 

$A$'nin kolon baðýmsýz olmasý uygulamalar açýsýndan pek anormal deðil, $m
\times n$ boyutlarý için cogunlukla $m > n$ olur, En Az Kareler gerektiren
problemler çoðunlukla aþýrý tanýmlý (overdetermined) problemdirler, çok
denklem az bilinmeyen vardýr, ve bu durumda çoðunlukla kerte $n$ olur. Yani
örnek olarak mesela, tipik $A$ içinde $m$ yüzlerce hatta binlerce, $n$
onlarca, böyle bir durumda, onlarca kolonun her birinin binlerce öðesi var,
ve bu öðelerin ya birbiri ile ayný, ya da birbirlerinin katý olmasý gerekir
ki baðýmlýlýk ortaya çýksýn. Gerçek dünyadan gelen verilerde bunun olmasý
hakikaten ufak bir ihtimal.

$R$'nin tersi alýnabilir olmasýna gelelim.

Ýspat

$A^TA = R^TR$

bulmuþtuk. Bunu ve bir diðer özelliði kullanacaðýz: iki eþsiz olmayan
(nonsingular) matrisin çarpýmý eþsiz deðildir (burada alternatif olarak
{\em Ders 14}'teki $A$ kolonlarý baðýmsýz ise $A^TA$'nin tersi alýnabilir
ispatýný da kullanabilirdik). $A$ eþsiz deðildir, o zaman $A^TA$ ayný
þekilde eþsiz deðildir.

[3, sf 20]; Burada iki matris $B,D$ eþsiz ise onlarýn çarpýmlarýnýn eþsiz
olduðunu ispatlayacaðýz. 

Ýspat

Diyelim ki $X=B^{-1}D^{-1}$, $(DB)X=I$'mi kontrol et.

$$ DB (B^{-1}D^{-1}) = D(BB^{-1})D^{-1} = DD^{-1} = I $$

Bir diðer teori. $A^TA$ eþsiz deðil ise $A$ kesin eþsiz deðil midir? Evet
öyledir.

Ýspat

$$ (A^TA)^{-1} (A^TA)= I $$

$$ A^{-1}A^{-T}A^TA = I$$

$$ A^{-1}A = I$$

Bu bilgileri kullanalým; $A^TA = R^TR$ olduðuna göre $R^TR$ da eþsiz
deðildir (tersi alýnabilir). O zaman üstteki ispata göre $R$ de eþsiz
deðildir, demek ki $R$'nin tersi alýnabilir.

Kaynaklar 

[1] Strang, G. {\em Introduction to Linear Algebra, 4th Ed}

[2] Boyd, {\em EE 263 Lecture}

[3] Meyer, {\em Matrix Analysis and Applied Linear Algebra}

[4] Bayramli, Lineer Cebir, {\em Uzaklýklar, Norm ve Benzerlik}

\end{document}
