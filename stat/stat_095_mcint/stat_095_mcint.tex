\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Monte Carlo, Entegraller

Monte Carlo entegrasyonu bir entegral mesela $f(x)$'i sayısal olarak kestirmek
(estimation), ona yakın bir sonuca sayısal olarak erişmenin
yöntemidir. Arkasında yatan teori oldukca basit, diyelim ki $f(x)$'i bir $D$
tanım bölgesi (domain) üzerinden entegre etmek istiyoruz [1].

$$
I = \int_{x \in D} f(x) \ud x
$$

Tek değişkenli fonksiyonlar için etki tek boyutlu ve entegrasyon sınırları
basit olarak $a$ ile $b$ arasında.

Biraz cebirsel numara yaparsak, mesela üstteki formülü $p(x)$ ile çarpalım
bölelim (hiçbir değişiklik yaratmamış oluyoruz aslında)

$$
I = \int_{a}^{b} \frac{f(x)}{p(x)} p(x) \ud x
$$

$f(x)/p(x)$ bölümüne bir isim verelim, mesela $g(x)$,

$$
I = \int_{a}^{b} g(x) p(x) \ud x
$$

Üstteki formül bir beklenti (expectation) hesabına benzemiyor mu? Evet,
$g(x)$'in $p(x)$ yoğunluğu üzerinden beklentisi bu formüldür, 

$$
E[g(x)] = I = \int_{a}^{b} g(x) p(x) \ud x
$$

Beklenti hesabını örneklem ortalaması ile yaklaşık hesaplayabileceğimizi
biliyoruz, etki alanından $N$ tane $x_i$ örneklemi alalım mesela, o zaman

$$
E[g(x)] \approx
\frac{1}{N} \sum_{i=1}^{N} g(x_i) =
\frac{1}{N} \sum_{i=1}^{N} \frac{f(x_i)}{g(x_i)}
$$

Diyelim ki $a,b$ arasında örneklem aldığımız sayılar birörnek (uniform)
dağılımdan geliyor, yani $p(x)$ birörnek dağılımın yoğunluğu, $p(x) = 1/(b-a)$,
bunu üstteki son formüle sokarsak,

$$
= (b-a) \frac{1}{N} \sum_{i=1}^{N} f(x_i) 
$$

Bu son formül $f(x)$'in $a,b$ arasındaki ortalamasını hesaplıyor ve onu aralığın
uzunluğu ile çarpıyor, bir anlamda bir dikdörtgen alanını hesaplıyoruz,
ki bu dikdörtgenin eni $a,b$ aralığının uzunluğu, yüksekliği ise $f(x)$'in
beklenti değeri.

Mesela $f(x) = x^2$'nin entegralini bulalım, aralık $-2,+2$ arası,

\begin{minted}[fontsize=\footnotesize]{python}
def func1(x):
    return x**2

def func1_int(a, b):
    return (1/3)*(b**3-a**3)
  
def mc_integrate(func, a, b, n = 1000):
    vals = np.random.uniform(a, b, n)
    y = [func(val) for val in vals]    
    y_mean = np.sum(y)/n
    integ = (b-a) * y_mean    
    return integ

print(f"Monte Carlo çözümü: {mc_integrate(func1, -2, 2, 500000): .4f}")
print(f"Analitik çözüm: {func1_int(-2, 2): .4f}")
\end{minted}

\begin{verbatim}
Monte Carlo çözümü:  5.3254
Analitik çözüm:  5.3333
\end{verbatim}





Kaynaklar

[1] Zhao, {\em Monte Carlo integration in Python over univariate and multivariate functions},
    \url{https://boyangzhao.github.io/posts/monte-carlo-integration}

[2] Pharr, {\em Physically Based Rendering 3rd Ed}
    
\end{document}


