\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Pürüzleþtirilmiþ Parcaçýk Hidrodinamiði (Smoothed Particle Hydrodynamics -SPH-)

SPH sývýlarýn dinamik hareketini görmemizi saðlayan bir simulasyon
tekniðidir. Lagrangian bakýþ açýsýný temel alýr, yani Euler aksine, bir sývý
paketini takip edip nereye gittiðine, hangi deðiþimlere uðradýðýna
bakarýz.

Akýþ dinamiðini anlatan [5]'te

$$
\rho \frac{D \bar{u}}{D t} = F^{toplam} 
$$

denklemini gördük. Bu Newton'un $F=ma$ formülasyonun bir karþýlýðý. Bu denklemde
basýnç, aðdalýk gibi kuvvetler için terimler vardý. Toplam kuvvetleri açarsak,

$$
F^{toplam}  = F^{\textrm{basýnç}} + F^{\textrm{aðdalýk}} + F^{\textrm{yerçekim}} 
$$

Daha detaylý hali,

$$
\rho \frac{D \bar{u}}{D t} = 
- \nabla p + \mu \nabla \cdot \nabla \bar{u} + \rho \bar{g}
\mlabel{1}
$$

Simulasyon için bize ivme gerekli. Kütle ve kuvvetten ivme, oradan sayýsal
entegrasyon ile yer deðiþimi elde edilebilir, katý-gövde simulasyonunu kodlarken
[6]'da bu anlatýlmýþtý. O zaman eldeki $i$'inci parçacýk için toplam kuvvet
$F_i$ hesaplarsak

$$
a_i = \frac{\ud u_i}{\ud t} = \frac{F_i}{\rho_i}
$$

ile ivmeyi buluruz, ve oradan devam ederiz.

Þimdi bize gereken $\nabla p(r_i)$ ve $\nabla^2 u(r_i)$ hesaplarýný yaklaþýk
yapabilmemizi saðlayacak bir yaklaþým kullanmak. SPH teknikleri bunu saðlýyor.

Bir fonksiyon $A$ aradeðerleme (interpolation), yaklaþýklama üzerinden temsil
edilebilir [1],

$$
A_I(r) = \int A(r') W(r-r',h) \ud r'
$$

Belirtilmediði yerlerde $r = \bar{r}$, $u = \bar{u}$ kabul edilebilir, bunlar
vektör, $\ud r'$ diferansiyel hacim öðesi. $A_I$ aradeðerlenmiþ fonksiyon, $A$
yaklaþýk göstermeye uðraþtýðýmýz fonksiyon. $A$ simulasyon ortamýnda hesaplanan
herhangi bir ölçüt olabilir, mesela herhangi bir $r=(x,y,z)$ noktasýndaki
basýnç, sýcaklýk, yoðunluk, vs.

$W$ aðýrlýk fonksiyonudur, ya da çekirdek (kernel) fonksiyonu, sahip olmasý
gereken bir þart,

$$
\int_\Omega  W(r-r',h) \ud r' = 1
$$

ve

$$
\lim_{h \to 0} W(r,h) = \delta(r)
$$

[4, sf. 11]. [4]'te bu tekniðin Dirac fonksiyonu ile baðlantýlarý
anlatýldý. Eðer $W = \delta$ dersek, yani çekirdek için Dirac fonksiyonu
kullanýrsak, orijinal fonksiyonun kendisini elde ederiz.

Yaklaþýklamayý sývýya uygulamak için onu kütle öðelerine bölmemiz gerekli,
$i$'inci öðe $m_i$ kütlesine, $\rho_i$ yoðunluðuna, ve $\bar{r}_i$ pozisyonuna
sahip olacak. $A$'nýn $i$ parçacýðýndaki deðeri $A_i$ ile gösterilsin. Her
parçacýk için,

$$
A(r) = \int A(r') W(r-r',h) \ud r'
$$

$$
 = \int \frac{A(r')}{\rho(r')} W(r-r',h) \rho(r') \ud r'
$$

Yaklaþýklýk için $A_I(r)$ da diyebilirdik, ya da $\approx$
kullanabilirdik.

$\rho(r')$'i hem bölen hem bölünene eklediðimiz için hiçbir deðiþim yaratmamýþ
olduk, ama böylece $\rho(r') \ud r'$ ifadesi elde ettik ki ona parçacýk kütlesi
diyebiliriz. Böylece parçacýklarýn kütleleri üzerinden bir toplam alabiliriz,

$$
A_s(r) = \sum_b m_b \frac{A_b}{\rho_b} W(r-r_b, h)
$$

Bu toplam teoride tüm parçacýklar üzerindendir, fakat pratikte $r$'ye yakýn olan
diðer parçacýklar üzerinden alýnýr, çoðunlukla çekirdek $2h$ gibi bir uzaklýkta
zaten hýzla sýfýra düþtüðü için, ayrýca performans açýsýndan, çok uzaktaki
parçacýklarý göz önüne almaya gerek yoktur.

Üstteki formül bana herhangi bir $r$ noktasýnda hesaplayabileceðim bir kestirme
hesap (estimation) vermiþ oldu. Parcaçýk bazlý simulasyon yaptýðýmýz için her
$i$ parçacýðý çevresindeki $j$ parçacýklarý üzerinden bu kestirme hesabý
yapabileceðiz.

Aradeðerlemenin bize saðladýðý güzel bir özellik onun üzerinden mesela gradyan
alabilmem. Diyelim ki $A$ ölçümü basýnç, yani $p$. O zaman (1)'de görülen
$-\nabla p$ formülünü üstteki entegral üzerinden açabilmem gerekir. $r$'de olan
her $i$ parçacýðý için $p(r_i)$ diyelim,

$$
p(r_i) = \sum_j \frac{m_j p_j}{\rho_j} W(r_i-r_j,h)
$$

Bu denklemin gradyanýný alabiliriz þimdi,

$$
\nabla p(r_i) = \sum \frac{m_j p_j}{\rho_j} \nabla W(r_i-r_j,h)
$$

Gradyan direk $W$ üzerinde uygulanmýþ oldu. Burada modellemeyi yapan kiþi tabii
ki $W$'yi ``gradyaný rahat alýnan'' fonksiyonlar arasýndan da seçecektir,
böylece iþler daha da kolaylaþacaktýr.

O zaman üstteki sonuç ile $-\nabla p$ yazarsak,

$$
F_i^{\textrm{basýnç}} = - \sum_j \frac{m_j p_j}{\rho_j} \nabla W(r_i-r_j,h)
$$

elde ederiz.

Fakat burada bir problem var, $j$ bölgesindeki basýncý kullanarak o fark
üzerinden $i$ üzerindeki kuvveti hesapladýk, fakat basýnç farký dolayýsýyla
$i$'nin $j$ üzerinde uyguladýðý kuvvet ayný olmayabilir. Yani kuvvet simetrik
olmaz, fakat fizik kanunlarýna göre etki-tepki ayný olmalýdýr. Simulasyon
amacýyla çoðunlukla yapýlan dýþarýdan müdahele ile kuvveti simetrik hale
getirmektir, mesela bir yöntem basit aritmetik ortalama almak,

$$
F_i^{\textrm{basýnç}} = - \nabla p(r_i) =
- \sum_j m_j \frac{p_i + p_j}{2 \rho_j} \nabla W(r_i-r_j,h)
$$

Aðdalýk kuvvetine gelelim. Ýlk baþta (1) bazlý olarak bu formül

$$
F_i^{\textrm{aðdalýk}} = \mu \sum_j m_j \frac{u_j}{\rho_j} \nabla^2 W (r_i-r_j, h)
$$

olarak yazýlabilirdi, fakat simetriklik problemi burada da var. Bu problem de
hýza olan baðlantýyý izafi hýza çevirerek çözülebilir, çünkü fiziksel olarak
düþünülürse esas önemli olan mutlak hýzlar deðil iki parçacýðýn hýzlarýnýn
farký, ya da bir parçacýðýn diðerine baktýðýnda gördüðü hýz (ki bu izafi demek)
o zaman

$$
F_i^{\textrm{aðdalýk}} = \mu \sum_j m_j \frac{u_j-u_i}{\rho_j} \nabla^2 W (r_i-r_j, h)
$$

daha uygun olur.

Çekirdek Fonksiyon Seçimi

SPH'in stabilitesi, doðruluðu ve hesap hýzý pürüzleþtirme çekirdeðinin doðru
seçilmiþ olmasýna baðlý [2]. Çekirdek fonksiyonlarýný hangisinin, hangi
durumlarda iyi olacaðý aktif bir araþtýrma alanýdýr. Yaygýn kullanýlan bir
çekirdek \verb!poly6! ismiyle bilinen 6. derece polinom çekirdeði. Bu fonksiyon,

$$
W_{poly6} (r, h) = \frac{315}{64 \pi h^9}
\left\{ \begin{array}{ll}
(h^2 - ||r||^2)^3 & 0 \le ||r|| \le h \\
0 & ||r|| > h
\end{array} \right.
$$

Gradyaný,

$$
\nabla W (r, h) =
- \frac{945}{32 \pi h^9} r ( h^2 - ||r||^2)^2
$$

Laplasyaný ise,

$$
\nabla^2 W (r, h) =
- \frac{945}{32\pi h^9} (h^2 - ||r||^2)(3 h^2 - 7||r||^2)
$$

Tek boyutta ve $h=1$ üzerinden her üç fonksiyonu grafikleyebiliriz,

\begin{minted}[fontsize=\footnotesize]{python}
r = np.linspace(-1,1,100)
h = 1
import pandas as pd
df = pd.DataFrame(r)
df.columns = ['r']
df['W'] = (315./(64*np.pi*h**9)) * (h**2 - np.abs(r)**2)**3
df = df.set_index('r')
df.plot()
plt.savefig('compscieng_app40sph_01.png')
\end{minted}

\includegraphics[height=6cm]{compscieng_app40sph_01.png}

\begin{minted}[fontsize=\footnotesize]{python}
df = pd.DataFrame(r)
df.columns = ['r']
df['W'] = (315./(64*np.pi*h**9)) * (h**2 - np.abs(r)**2)**3
df['Gradyan W'] = -945./(32*np.pi*h**9) * r * (h**2 - np.abs(r)**2)**2
df = df.set_index('r')
df.plot()
plt.savefig('compscieng_app40sph_02.png')
\end{minted}

\includegraphics[height=6cm]{compscieng_app40sph_02.png}

\begin{minted}[fontsize=\footnotesize]{python}
df = pd.DataFrame(r)
df.columns = ['r']
df['W'] = (315./(64*np.pi*h**9)) * (h**2 - np.abs(r)**2)**3
df['Gradyan W'] = -945./(32*np.pi*h**9) * r * (h**2 - np.abs(r)**2)**2
df['Laplasyan W'] = -945./(32*np.pi*h**9) * \
                   (h**2-np.abs(r)**2) * \
                   (3*h**2 - 7**np.abs(r)**2)
df = df.set_index('r')
df.plot()
plt.savefig('compscieng_app40sph_03.png')
\end{minted}

\includegraphics[height=6cm]{compscieng_app40sph_03.png}





[devam edecek]

Kaynaklar

[1] Monaghan, {\em Smoothed particle hydrodynamics, 2005}

[2] Schuermann, {\em Particle-Based Fluid Simulation with SPH},
    \url{https://lucasschuermann.com/writing/particle-based-fluid-simulation}

[3] Bayramlý, {\em Hesapsal Bilim, Ders 4}

[4] Kelager, {\em Lagrangian Fluid Dynamics Using Smoothed Particle Hydrodynamics}

[5] Bayramlý, {\em Fizik, Akýþ Dinamiði}

[6] Bayramlý, {\em Fizik, Simulasyon}

[7] Monaghan, {\em Introduction to SPH Part I},
    \url{https://www.youtu.be/tAXHCAEgSuE}

[8] Müller, {\em Particle-Based Fluid Simulation for Interactive Applications}


\end{document}

