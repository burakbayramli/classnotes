<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"], cancelto: ["Extension","cancel"]
      });
    });
    </script>  
   
  <title>Döviz Kuru Ticareti</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<div id="header">
</div>
<h1 id="döviz-kuru-ticareti">Döviz Kuru Ticareti</h1>
<p>Eğer döviz kurları üzerinden al/sat yapmak istersem bunu
koentegrasyon üzerinden nasıl yaparım? Aynen iki hissenin fiyatının
koentegre olabilmesi gibi, iki ülkenin dövizi de koentegre olabilir. Bu
koentegrasyon tabii ki bu dövizlerin kurlarına yansıyacaktır, ve bu
kurların üzerinden alım / satım yaparsak o koentegrasyona oynamış
oluruz. Daha önce gördüğümüz ETF örneğini genişletmek gerekirse,
Avustralya ve Kanada’nın ETF’leri koentegre idi, herhalde onların döviz
kurlarının da koentgre olduğunu beklemek anormal olmaz. Bu hakikaten
böyle. Ama ondan önce döviz ticareti hakkında bazı pürüzler.</p>
<p>Döviz ticareti hisse ticaretinden biraz farklı. Mesela AUD.ZAR
(Avustralya doları ve Güney Afrika randı) ticareti yapıyorsak, bunlardan
birincisi baz dövizi (base currency) diğeri kayıt dövizi (quote
currency) olarak biliniyor. Hatırlamanın iyi bir yolu baz’ın b’si
kayıtın k’sinden önce gelir. Eğer AUD.ZAR 9.58’den kayıtlıysa bir AUD
almak için 9.58 ZAR gerekir. Eğer 100,000 AUD.ZAR alıyorsak önceki kayıt
fiyatından 100,000 x 9.58 = 958,000 ZAR satmak gerekir.</p>
<p>Fakat çoğu zaman aracı kurumlar AUD.ZAR kurunu sağlamazlar. Bu yüzden
X Avustralya doları AUD.ZAR alabilmek için X birim B.ZAR alıp X birim
B.AUD satmak gerekir, ki burada B başka bir baz döviz olacaktır. B
çoğunlukla likiditesi yüksek olan rahatça alınıp satılabilecek bir
dövizden seçilir, mesela USD (dolar) ya da EUR (avro) gibi.</p>
<p>Alttaki dosyaları almak için [1]’e bakınız.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd, os, sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> io <span class="im">as</span> spio</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">&#39;tday&#39;</span>,<span class="st">&#39;cl&#39;</span>,<span class="st">&#39;lo&#39;</span>,<span class="st">&#39;hi&#39;</span>,<span class="st">&#39;hhmm&#39;</span>,<span class="st">&#39;op&#39;</span>]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> <span class="st">&quot;/opt/Downloads&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> spio.loadmat(base <span class="op">+</span> <span class="st">&#39;/inputData_USDCAD_20120426.mat&#39;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>usdcad <span class="op">=</span> pd.concat([pd.DataFrame(a[x]) <span class="cf">for</span> x <span class="kw">in</span> cols], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>usdcad.columns <span class="op">=</span> cols</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> spio.loadmat(base <span class="op">+</span> <span class="st">&#39;/inputData_AUDUSD_20120426.mat&#39;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>audusd <span class="op">=</span> pd.concat([pd.DataFrame(a[x]) <span class="cf">for</span> x <span class="kw">in</span> cols], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>audusd.columns <span class="op">=</span> cols</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>usdcad2 <span class="op">=</span> usdcad[(usdcad.tday<span class="op">&gt;</span><span class="dv">20090101</span>) <span class="op">&amp;</span> (usdcad.hhmm <span class="op">==</span> <span class="dv">1659</span>)]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>audusd2 <span class="op">=</span> audusd[(audusd.tday<span class="op">&gt;</span><span class="dv">20090101</span>) <span class="op">&amp;</span> (audusd.hhmm <span class="op">==</span> <span class="dv">1659</span>)]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>usdcad2 <span class="op">=</span> usdcad2.set_index([<span class="st">&#39;tday&#39;</span>,<span class="st">&#39;hhmm&#39;</span>])</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>audusd2 <span class="op">=</span> audusd2.set_index([<span class="st">&#39;tday&#39;</span>,<span class="st">&#39;hhmm&#39;</span>])</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>cad <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> usdcad2.cl</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>aud<span class="op">=</span>audusd2.cl</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pd.concat([aud, cad],axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">&#39;../tser_030_coint&#39;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">&#39;../tser_010_back&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> johansen <span class="im">import</span> coint_johansen</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>trainlen<span class="op">=</span><span class="dv">250</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>lookback<span class="op">=</span><span class="dv">20</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>numUnits <span class="op">=</span> np.ones(<span class="bu">len</span>(y))<span class="op">*</span>np.nan</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>hedgeRatio <span class="op">=</span> np.ones(y.shape)<span class="op">*</span>np.nan</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(trainlen,<span class="bu">len</span>(y)):</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>   df <span class="op">=</span> y[t<span class="op">-</span>trainlen:t]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>   hedgeRatio[t] <span class="op">=</span> coint_johansen(df, <span class="dv">0</span>, <span class="dv">1</span>).evec[:,<span class="dv">0</span>]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>   tmp1 <span class="op">=</span> np.array(y[t<span class="op">-</span>lookback:t])</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>   tmp2 <span class="op">=</span> np.kron(np.ones((lookback,<span class="dv">1</span>)),hedgeRatio[t])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>   yport <span class="op">=</span> np.<span class="bu">sum</span>(tmp1<span class="op">*</span>tmp2,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>   ma<span class="op">=</span>np.mean(yport)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>   mstd<span class="op">=</span>np.std(yport)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>   zScore<span class="op">=</span>(yport[<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span>ma)<span class="op">/</span>mstd<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>   numUnits[t] <span class="op">=</span> <span class="op">-</span>(yport[<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span>ma)<span class="op">/</span>mstd</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>   <span class="co">#break</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># copy positions in multiple coumns. positions are market values </span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># of AUDUSD and CADUSD in portfolio expressed in US.</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>tmp1<span class="op">=</span>np.kron(np.ones((y.shape[<span class="dv">1</span>],<span class="dv">1</span>)),numUnits)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> tmp1.T <span class="op">*</span> hedgeRatio <span class="op">*</span> y</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>pnl <span class="op">=</span> positions.shift(<span class="dv">1</span>) <span class="op">*</span> (y <span class="op">-</span> y.shift(<span class="dv">1</span>))  <span class="op">/</span> y.shift(<span class="dv">1</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>pnl <span class="op">=</span> pnl.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>ret<span class="op">=</span>pnl <span class="op">/</span> np.<span class="bu">sum</span>(np.<span class="bu">abs</span>(positions.shift(<span class="dv">1</span>)),axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>ret <span class="op">=</span> ret[trainlen:<span class="op">-</span><span class="dv">1</span>] <span class="co"># trainlen kadar ilk bolumu disarida birak</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>ret <span class="op">=</span> ret.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>cumret<span class="op">=</span>np.cumprod(<span class="dv">1</span><span class="op">+</span>ret)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&#39;APR&#39;</span>, ((np.prod(<span class="fl">1.</span><span class="op">+</span>ret))<span class="op">**</span>(<span class="fl">252.</span><span class="op">/</span><span class="bu">len</span>(ret)))<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&#39;Sharpe&#39;</span>, np.sqrt(<span class="fl">252.</span>)<span class="op">*</span>np.mean(ret)<span class="op">/</span>np.std(ret))</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&#39;Dusus Kaliciligi&#39;</span>, dd.calculateMaxDD(cumret))</span></code></pre></div>
<pre><code>APR 0.100221828618
Sharpe 1.44796592471
Dusus Kaliciligi (-0.050369126045008095, 158.0)</code></pre>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.cumprod(<span class="dv">1</span><span class="op">+</span>ret)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Kümülatif Birleşik Getiri&#39;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;tser_curr_01.png&#39;</span>)</span></code></pre></div>
<p><img src="tser_curr_01.png" /></p>
<p>Kaynaklar</p>
<p>[1] Chan, <em>Book Code</em>, <a
href="https://github.com/burakbayramli/books/tree/master/Algorithmic_Trading_Chan">https://github.com/burakbayramli/books/tree/master/Algorithmic_Trading_Chan</a></p>
<p>[2] Chan, <em>Algorithmic Trading</em></p>
<p>
  <a href="..">Yukarı</a>
</p>
</body>
</html>
