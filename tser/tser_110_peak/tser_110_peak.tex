\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Gayri Lineer Regresyon, Petrol Tepe Noktasý (Peak Oil)

Hubbard adýnda bir jeolog ülkesi Amerika'da petrol üretiminin 1970 senesi
civarýnda tepe noktasý yapacaðýný tahmin etmiþti. Bu tahmin için kullandýðý
formül altta,

$$ 
c = \frac{ 2c_m}{1 + \cosh |b_c(t-t_{mc})|   }
$$

Formül bir S þeklini modellemektedir ve S'in tepe noktasý bizim için ilginç
noktadýr, çünkü üretimin tepe yaptýðý seneyi gösterir. Hubbard'ýn böyle bir
formülü kullanmasýnýn sebebi onun petrol üretimini önce azar azar
ilerleyen, sonra kolay kaynaklarý keþfedip onlarý ardý ardýna iþleyerek
fýrlama gösteren, ama sonra kolay kaynaklarýn tükenmesi sonucunda zor
olanlara baþvurmaya baþlayýp ``artýþýn azalarak'' nihai bir tepe noktasýna
ulaþtýktan sonra iniþe geçen bir trend olarak görmesiydi.

Hubbard bu analizi 1966 yýlýnda yapmýþtý. Bakalým biz de ayný sonuca
ulaþabilecek miyiz? Biz hatta veride 1960 sonrasýný kesip atalým, ve
geleceði ``bilmiyormuþ gibi'' yapýp onu tahmin etmeye uðraþalým. Önce tüm
verinin bir grafiði,

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd
us = pd.read_csv('us.csv',sep='\s')
us1960 = us[(us['year'] < 1960)]
us.set_index('year')['uretim'].plot(title='Amerika Petrol')
plt.savefig('tser_peak_01.png')
\end{minted}

\includegraphics[height=6cm]{tser_peak_01.png}

Veriyi modele uydurmak için olduðu lineer regresyon kullanmamýz lazým. Bunun
için pek çok deðiþik yazýlým var, mesela \verb!scipy.optimize! altýnda bazý
seçenekler, \verb!fmýn! bunlardan biri, ya da \verb!lmfit! adlý paket
kullanýlabilir. Biz \verb!lmfit! kullanacaðýz çünkü uydurduðu modeldeki
parametreler için bir güven aralýðý (confidence interval) geri döndürüyor.

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd, math
import scipy.linalg as lin
import lmfit

def find_peak(df,cminit,bcinit,tmcinit):
    minyear = df['year'].min()
    df['year'] = df['year'] - minyear
    def err(w):
        cm=w['cm'].value;bc=w['bc'].value;tmc=w['tmc'].value
        tmp = (1.+np.cosh(bc*(df['year']-tmc)))
        yfit = 2.0 * cm /  tmp
        return df['uretim']-yfit

    p = lmfit.Parameters()
    p.add_many(('cm', cminit), ('bc', bcinit),('tmc', tmcinit))
    mi = lmfit.minimize(err, p)
    lmfit.printfuncs.report_fit(mi.params)
    print mi.params['tmc'].value + minyear
    return mi
\end{minted}

\begin{minted}[fontsize=\footnotesize]{python}
resus = find_peak(us1960.copy(),0,0,4)
\end{minted}

\begin{verbatim}
[[Variables]]
    cm:    2.8183e+06 +/- 1.34e+05 (4.76%) (init= 0)
    bc:   -0.06663767 +/- 0.002648 (3.98%) (init= 0)
    tmc:   66.8998632 +/- 2.142183 (3.20%) (init= 4)
[[Correlations]] (unreported correlations are <  0.100)
    C(cm, tmc)                   =  0.958 
    C(bc, tmc)                   =  0.939 
    C(cm, bc)                    =  0.825 
1966.89986324
\end{verbatim}

Tahmin kabaca 1967 yýlý -/+ 2 sene olarak yapýldý yani bir uçta 1969
senesini veriyor, gerçek tepe noktasý 1970 yýlýnda meydana geldi.  Fena
deðil.

Bu arada, üstteki güven aralýklarý en baz hesaplar kullanarak yapýldý,
\verb!lmfit! paketi çok daha çetrefil bir hesap ile bu aralýðý hesaplayabiliyor,
daha fazla detay için [3]'e bakýnýz, çaðrý þöyle,

\begin{minted}[fontsize=\footnotesize]{python}
cius = lmfit.conf_interval(resus)
for ci in cius['tmc']: print ci
\end{minted}

\begin{verbatim}
(0.997, 61.74775035073711)
(0.95, 63.323717490043805)
(0.674, 64.99845280348576)
(0.0, 64.814585259840328)
(0.674, 69.12696883524737)
(0.95, 71.83614364894831)
(0.997, 75.45739023924693)
\end{verbatim}

Eðer yüzde 95 güven aralýðý bu hesaplara göre ayarlanýrsa, 

\begin{minted}[fontsize=\footnotesize]{python}
print [us['year'].min()+63, us['year'].min()+71]
\end{minted}

\begin{verbatim}
[1963, 1971]
\end{verbatim}

Dünya Üretimi

Þimdi ilginç bir örnek: Dünya için tepe noktasý nedir, yani dünya üretiminde
tepe hangi senede bulunacaktýr?

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd
import lmfit
world = pd.read_csv('world.csv',sep='\s',comment='#')
minyear = world['year'].min()
resworld = find_peak(world.copy(),0,0,0)
cm=resworld.params['cm'].value
bc=resworld.params['bc'].value
tmc=resworld.params['tmc'].value
def hubbard(x): return 2*cm / (1+np.cosh(bc*(x-tmc))) 
world['tahmin'] = map(hubbard, world['year']-minyear)
\end{minted}

\begin{verbatim}
[[Variables]]
    cm:    86.4960058 +/- 2.078688 (2.40%) (init= 0)
    bc:    0.04525865 +/- 0.002847 (6.29%) (init= 0)
    tmc:   61.2630977 +/- 2.766022 (4.51%) (init= 0)
[[Correlations]] (unreported correlations are <  0.100)
    C(bc, tmc)                   = -0.905 
    C(cm, tmc)                   =  0.693 
    C(cm, bc)                    = -0.441 
2011.26309773
\end{verbatim}

Sonuç 2011 yýlý -/+ 3 sene, yani bir uçta 2014 senesi! Geçtiðimiz sene tepe
noktasýný bulmuþuz demektir bu. Eðer daha ciddi güven aralýklarýný
hesaplarsak,

\begin{minted}[fontsize=\footnotesize]{python}
ciworld = lmfit.conf_interval(resworld,(0.95))
for ci in ciworld['tmc']: print ci
\end{minted}

\begin{verbatim}
(0.997, 54.82763905336239)
(0.95, 56.71191865850853)
(0.674, 58.77959133281453)
(0.0, 59.532276980950712)
(0.674, 64.23478501286465)
(0.95, 68.15617586218289)
(0.997, 73.89068095609822)
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
print [minyear+56, minyear+68]
\end{minted}

\begin{verbatim}
[2006, 2018]
\end{verbatim}

Bu güven aralýðý da sað uç noktada 2018 senesini gösteriyor. Bu aralýða
göre en kötü (ya da iyi) ihtimalle yakýn bir zamanda petrol tepe üretiminde
tepe noktasýna eriþeceðiz demektir.

\begin{minted}[fontsize=\footnotesize]{python}
world.set_index('year').plot(title='Dunya Petrol')
plt.savefig('tser_peak_02.png')
\end{minted}

\includegraphics[height=6cm]{tser_peak_02.png}

Bu noktada son 10 senedeki ilginç bir geliþmeden bahsetmek lazým. Hem ABD
hem de dünya üretiminde ilginç bir zýplama oldu, çünkü ABD'de tazyikli su
kullanarak (fracking) petrol çýkartan bir teknik kullanýlmaya
baþlandý. Soru þu: Bu teknik ve üretimde zýplama acaba modelin ana
varsayýmýnda deðiþikliðe sebep verir mi? Teknik çok etkili ama acaba
petrolün bulunmasýnýn zorlaþmasý ile mi alakalý, ki çevreye kötü etkileri
olduðu da biliniyor ve politikacýlara baský ile belki bitirilir, yoksa
kalýcý bir þey ve öyle bir artýþa sebep olacak ki þimdiye kadar olan petrol
üretimini bile yarýyolda býrakacak bir baþlangýç noktasýndayýz...?  Eðer
1. durum doðru ise, iniþ baþlayacaktýr, ve azalan petrol paylaþýmý
etrafýnda çatýþmalar daha hýzlanacaktýr. Belki de son zamanlarda bunun
etkilerini görüyoruz!

Not: Optimizasyon rutinleri için, özellikle \verb!lmfit! gibi lineer
optimizasyon yapabilen rutinler için, farklý baþlangýç deðerleri farklý
sonuçlarýn oluþmasýna sebep olabilir. Bu sebeple stabil optimum noktasýný
bulmak için birkaç farklý noktadan baþlangýç yapmak gerekebilir.

Kaynaklar

[1] Wikipedia, {\em Hubbert curve}, \url{http://en.wikipedia.org/wiki/Hubbert_curve}

[2] YCharts, {\em Brent Crude Oil Spot Price}, \url{http://ycharts.com/indicators/brent_crude_oil_spot_price}

[3] Newville, {\em Non-Linear Least Squares Minimization}, \url{http://github.com/lmfit/lmfit-py}

\end{document}
