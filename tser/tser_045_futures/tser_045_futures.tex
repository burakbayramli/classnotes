\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Vadeli Ýþlem Sözleþmeleri (Futures Contracts)

Bir alýcý bir satýcý arasýnda standardize edilmiþ miktar, kalite, ve nakliyat
tarihi ve fiyatý alým günü önceden karalaþtýrýlan sözleþmelere vadeli iþlem
sözleþmeleri (VÝS) ismi veriliyor. Yani bugün üzerinde anlaþýlan miktar ve
kalitede enstrüman, sözleþme bittiði gün sözleþme alýcýsýna verilecektir,
sözleþme bunu garantileyen kanuni bir belgedir. Sözleþmedeki temel enstruman
miktarýna eþit nakit ödemesi de yapýlabilir, bu konunun detaylarýna
gireceðiz. Özet: Ödeme ve varlýðýn transferi gelecekte olur, fiyat
kararlaþtýrýlmasý bugün olur [1], [2, sf. 202]. VÝS piyasalarý medyada daha çok
ilgi gören senet piyasalarýndan kat kat daha büyüktür.

VÝS'ler çoðunlukla petrol, bakýr, kahve, mýsýr, vs. gibi emtia ürünlerinde
bilinir, fakat bir VÝS'in temel enstrümaný finansal bile olabilir; mesela S\&P
500 indisini temel alan VÝS vardýr, Eurodollar'ý temel alan VÝS de
vardýr. Kontratlar standarttýr demiþtik, mesela New York kahve sözleþmesi 17
ton'dur (37,500 pound), Chicago mýsýr sözleþmesi 5,000 kiledir (bushel), ya da
Britanya para birimi pound'u için sözleþme 62,500 pound alýþverisi
üzerindendir. Her sözleþmenin fiyat bilgisi farklý ölçekte olabilir, buna
dikkat, mesela hububat ürünleri kile baþýna dolar olarak, bakýr her pound
(aðýrlýk birimi) için sent olarak (dolarýn kuruþu) alýnýr ve satýlýr.

Aracý kurumlarý alým fiyatýnýn tamamýnýn hemen ödenmesini mecbur kýlmaz, bir
teminat (margin), tüm fiyatýn ufak bir yüzdesi üzerinden sözleþmeye girilmesine
izin verir. Bu ufak yüzde tabii ki finansal baðlamda borsacýlar tarafýndan
kaldýraç olarak ta kullanýlabilir, eðer teminat için yüzde 10 gerekiyorsa, bunu
10 seviyesinde bir kaldýraç olarak kullanabiliriz.

Sözlemelerin teslimatý ay bazýndadýr, o ayýn belli gününde teslimat olur, o ayda
baþka günde teslimat olmaz. Ayrýca her ayda teslimat olmayabilir, bu tarým
ürünlerini düþününce mantýklý herhalde, çünkü her ürün her ayda hasat
yapýlamaz. Mesela buðdayýn (wheat) sadece Mart, Mayýs, Temmuz, Eylül ve Aralýk
teslimat günleri / sozlesmesi vardýr, Ocak buðday sözleþmesi almak ya da satmak
mümkün deðildir. Piyasalarda kontrat aylarý kodlanarak belirtiliyor, bu kodlar
Ocak'tan baþlayarak F, G, H, J, K, M, N, Q, U, V, X, Z diye gider. Harfler tam
bir sýrayý takip etmiyor, nedeni tam olarak bilinmeyen bir þekilde kodlama
böyle, o yüzden eþlemeyi bir yerde kayýtlý, ya da akýlda tutmak / ezberlemek
lazým, tahmin etmek mümkün deðil.

Sözleþme, teslimat günündeki ödenecek fiyatý garantilemek için yapýlýyorsa, o
zaman sözleþme fiyatýnýn piyasadaki dalgalanmasý o sözleþmenin baz aldýðý baz
ürünün teslimat günü / ayýndaki fiyatý hakkýnda bir genel ``tahmin'' olarak
algýlanabilir. Mesela bugün (Nisan 29, 2016) baktým, Aðustos 2016 ham petrol
sözleþmesinin (NYMEX CL) fiyatý 47.66 dolar, petrolün bugünkü fiyatý 46.41. Yani
VÝS piyasasý yaklaþýk 3 ay sonra petrol fiyatýnýn artacaðýný düþünüyor.

Bir sözleþmenin fiyatý, o sözleþmenin teslimat tarihi yaklaþtýkça, sözleþmenin
baz aldýðý ürünün günlük piyasa (spot) fiyatýna yaklaþýr. Bu arz talep
kanunlarýnýn kaçýnýlmaz sonucu - eðer bir sözleþme teslimat gününe çok yakýn baz
ürününden daha yukarýda ise açýða satýþlar olacaktýr, bu satýþlar VÝS'in
fiyatýný aþaðý çeker, az olduðu durumda tam tersi. Birkaç hafta sonra teslimatý
olacak kahve eðer bugün 10 lira civarýnda ise, bu sözleþmesi için kim 20 lira
öder ki? Ek not: teslimat tarihine yakýn bir VÝS'in likiditesi azalýr, yani o
sözleþme üzerinde alým / satým daha zorlaþýr, bu lojistik bir durum, akýlda
tutmak iyi olur. 

VÝS'lerin çýkýþ noktasý tarým ürünleridir. Bir çiftçi olduðumuzu düþünelim,
buðday üretiyoruz, fakat tarým ürünlerinde iklim þartlarýna göre hasat, ve aylar
sonraki fiyat beklenenden çok farklý olabilir, bu durumda VÝS belli miktar,
kalite ve daha önemlisi bir fiyatý þimdiden kitlememizi saðlar, bu çiftçi için
çok faydalý, mesela bir fiyatý kitlemek isteyen çiftçi buðday sözleþmesi (açýga)
satar. Diðer yandan buðday alýmý yapmak isteyen bir fýrýncý (ekmek yapmak için
buðday lazým), bir sözleþme satýn alabilir. Her iki taraf ta aylar, hatta yýllar
sonraki fiyatý kitlemiþ olur, gece rahat uyurlar.

Tabii sözleþmelerden, teslimattan bahsettik, fakat emtia bazlý VÝS'ler için bile
fiziki teslimat þart deðildir, hatta VÝS'lerin sadece yüzde 1'i fiziki
teslimatla sonuçlanýr. Teslimat gününde çoðunlukla nakit ödeme yapýlýr, mesela
çiftçi / fýrýncý örneðinde Haziran teslimatýnda kilesi 4 liradan anlaþýlmýþ
olabilir, ama Haziran ayýnda buðday kilesi 5 lira olmuþ diyelim; eðer sözleþme
5000 kile üzerinden ise, çiftçi aradaki 1 x 5000 = 5000 liralýk farký fýrýncýya
öder. Tabii çiftçi hala buðdayýný satmak istemektedir, ürününü yerel pazarda
satar mesela, günün fiyatý daha yüksek 5 lira olduðu için o fiyattan satýþ yapýp
o parayý ``kazanmýþ'' olur, ama daha önce kile baþý 1 liralýk farký sözleþme
farký yüzünden kaybetmiþti, ve sonuç olarak kile basýna 5-1=4 liralýk satým
yapmýþ olur. Ama bu problem deðil çünkü zaten ta önceden ``kitlediði'' fiyat
buydu! VÝS çiftçinin tam istediðini yapmýþ oldu. Diðer yandan fýrýncý 5000 lira
``kazandý'', ama hala buðday almak istiyor, o da kendi yerel pazarýndan kilesi 5
liradan alým yapar, sözleþme bedelinden daha yüksek bir fiyattan alým yapmýþ
oldu, fakat 1 liralýk farký nakit ödeme ile çiftçiden almýþtý, yani o da kile
basýna 5-1=4 liralýk alým yapmýþ oldu. Her iki taraf ta baþta razý olduklarý
fiyattan alým / satým yapmýþ oldular.

Eurodollar

Eurodollar VÝS'i 1 milyon dolarýn banka hesabýnda 3 ay tutulmasýnýn bedelini
(yani ona verilecek olan faizi) temsil eder. Enstrümanýn fiyatý 100 eksi bir
rakam üzerinden bir yýllýk faizi temsil eder, yani eðer fiyat 96 ise temsil
edilen yýllýk faiz 100-96=4, yüzde 4 demektir.

Örnek

Diyelim ki bir þirketin 1 Haziran'da bir yatýrým, harcama yapmasý gerekiyor,
bugün 1 Mart (harcama 3 ay sonra yani), bu harcama hesapta yoktu, bu bedelin 3
ay sonra borç alýnmasý gerekecek. Þirket karlý bir þirket, ve alýnan borcu
rahatlýkla 1 Eylül'de (borç alýmýndan yine 3 ay sonra) geri
ödeyebilecekler. Diyelim ki bu þirket yerel bankasýna gidip istediði zaman LÝBOR
+ 100 baz puanýndan (100 puan = yüzde 1) faiz ile borç alabiliyor.

Fakat 3 ay sonra LÝBOR'un ne olduðu bilinmiyor; eðer þirket bir faizi þimdiden
``kitlemek'' istiyorsa, 1 Haziran bitiþ tarihli 10 tane Eurodollar VÝS'i açýða
satabilir. Diyelim ki 1 Mart'ta VÝS'in fiyatý 93.00 ki bu yüzde 7 faiz oranýný
temsil eder. Bitiþ tarihi 1 Haziran'da fiyat 92.50 olmuþ olsun, yani faiz yüzde
7.5. Fiyatta 50 baz puanlýk deðiþim olduðu için bitiþ tarihinde þirket \$2500 x
0.5 x 10 kontrat = \$12,500 elde etmis olur. \$2500 nereden geldi? Bu deðer
yüzde 1'lik deðiþimi temsil eden blok deðeri, yüzde 1 yýllýk temelde, onu 3 ay
bazýna indirmek için 4'e böleriz, ve 1 milyon ile çarparýz, 1 milyon x 1/4 =
\$2500. Neyse, þirket bu þekilde gelecekteki bir faiz oranýný þimdiden kitlemiþ
oldu, artýk yüzde 7.5 + 100 baz puan ile borç alabilir, ama artýk 1 milyon -
\$12,500 = \$9,987,500 için borç almasý yeter, çünkü VÝS'ten bir kazanç elde
edildi. Kayýp ta olabilirdi, o zaman \$1,012,500 borç alýnmasý gerekecekti,
fakat daha düþük faizden. Her iki durumda da nihai faiz baþtan kitlenen yüzde 7
LÝBOR üzerinden hesaplanacaktýr. 

Vadeli Ýþlem Sözleþmesi Birleþtirmek

Ayný baz ürünü temel alan sözleþmeler farklý teslimat aylarýnda sunulabilir, o
zaman Aralýk 2015 kontratý almýþsak Aralýk ayý sonunda kontrat bittiðinde o
kontrattan çýkmamýþsak petrol bize gönderilecek demektir. Dikkat! Tabii
teslimat kapýnýza deðil, çoðunlukla bir limandaki bir depoya gönderilir. Neyse,
fakat spekülatörler genel olarak petrol yatýrým amaçlý bir ``petrol''
kontratýna para verirler, bu yatýrýmda, teslimat almadan, istedikleri kadar
kalabilmek, ya da kendilerine uygun bir zamanda çýkabilmek (ya da tekrar girmek)
isterler. O zaman kontratlar arasý bir þekilde geçiþ yapmak gerekir. Bu iþleme
geçiþ yapmak (rollover) deniyor, spekülatör kendine uygun zamanda bir
kontrattan diðerine geçiyor. Fakat bu durumda, en azýndan geçmiþe dönük analiz
baðlamýnda, elimizde ``parçalý'' bir zaman serisi olacaktýr, çünkü VÝS'ler
zamana baðlýdýr, ve her kontratýn, ayný alt emtiayý baz alýyor olsa bile,
fiyatlarý farklý olabilir. O zaman mesela geriye dönük kesintisiz bir zaman
serisi bekleyen analizlerimiz ne yapacak?

Altta VÝX indisini baz alan bir üç ayrý sözleþmeyi görüyoruz, biri Mayýs 2015,
diðeri Haziran 2015, öteki Temmuz 2015. Sözleþmeler finansal varlýklarý da baz
alabilir demiþtik, bu bir diðer örnek iþte, VÝX S\&P 500 indisinin
oynaklýðýný baz alan bir sözleþme.

Geçiþ için kontratlar arasýnda hangi tarihlerde atlama yapacaðýmýzý önceden
biliyoruz, bu tarihler altta \verb!stitch_point1!, ve \verb!stitch_point2!
içinde. Birleþtirme öncesi durumu gösterelim (alttaki örnek için veriyi
\verb!getvix.py!  ile alabiliriz).

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd

stitch_point1 = '2015-03-13'; stitch_point2 = '2015-04-15'

df1 = pd.read_csv('vixmay.csv',index_col=0,parse_dates=True)
df2 = pd.read_csv('vixjune.csv',index_col=0,parse_dates=True)
df3 = pd.read_csv('vixjuly.csv',index_col=0,parse_dates=True)

tmp = df1[(df1.index > '2015-02-13') & (df1.index <= stitch_point1 )]
tmp.Settle.plot(color='blue')
plt.hold(True)
tmp=df2[(df2.index >= stitch_point1) & (df2.index <= stitch_point2)]
tmp.Settle.plot(color='red')
plt.hold(True)
tmp=df3[(df3.index >= stitch_point2) & (df3.index < '2015-05-13')]
tmp.Settle.plot(color='yellow')
plt.savefig('tser_futures_01.png')
\end{minted}

\includegraphics[height=8cm]{tser_futures_01.png}

Görüldüðü gibi kesintiler var. Birleþtirme için kullanýlan yönteme Panama
yöntemi deniyor, detaylar [4]'te. Aslýnda yöntem çok basit, en sondaki
kontrattan baþlýyoruz, onun atlama noktasýndaki fiyat deðerini bir önceki
kontrattaki ayný noktadaki fiyatýnýn farkýný hesaplýyoruz, ve o fark kadar bir
önceki kontrattaki tüm fiyatlarý üste çekiyoruz. Ayný þekilde bir geriye doðru
devam ediyoruz.

\begin{minted}[fontsize=\footnotesize]{python}
diff = float(df3.ix[stitch_point2,'Settle'] - df2.ix[stitch_point2,'Settle'])
df2.loc[:,'Settle'] = df2.Settle + diff
diff = float(df2.ix[stitch_point1,'Settle'] - df1.ix[stitch_point1,'Settle'])
df1.loc[:,'Settle'] = df1.Settle + diff
\end{minted}

\begin{minted}[fontsize=\footnotesize]{python}
tmp=df1[(df1.index > '2015-02-13') & (df1.index <= stitch_point1 )]
tmp.Settle.plot(color='blue')
plt.ylim(15,21)
plt.hold(True)
tmp=df2[(df2.index >= stitch_point1) & (df2.index <= stitch_point2)]
tmp.Settle.plot(color='red')
plt.hold(True)
tmp=df3[(df3.index >= stitch_point2) & (df3.index < '2015-05-13')]
tmp.Settle.plot(color='yellow')
plt.savefig('tser_futures_02.png')
\end{minted}

\includegraphics[height=8cm]{tser_futures_02.png}

Fiyatlar akýcý bir þekilde birleþmiþ oldu. Biraz daha esnek bir kod üzerinden
birleþtirmeyi yaparsak,

\begin{minted}[fontsize=\footnotesize]{python}
import sys; sys.path.append('../tser_voltar')
import util

dfs = [df1,df2,df3]
sps = [stitch_point1, stitch_point2]
dfs = util.stitch_prices(dfs, 'Settle', sps)
dfs = dfs[(dfs.index > '2015-02-13') & (dfs.index < '2015-05-13')]
dfs.plot()
plt.savefig('tser_futures_05.png')
\end{minted}

\includegraphics[height=8cm]{tser_futures_05.png}

Oynaklýk ve Sözleþmeler

Mayýs 2015 ve Eylül 2015 Eurodollar kontratlarýna Mayýs ayýnda bakýnca (yani en
yakýn ve nisbeten uzak bir kontratý karþýlaþtýrýnca) fiyat serisinin ilkinde ne
kadar az oynaklýðý olduðunu, diðerinde daha fazla oynaklýk olduðunu görüyoruz.

\begin{minted}[fontsize=\footnotesize]{python}
# geted.py ile veriler alindi
import pandas as pd

df = pd.read_csv('edk.csv',parse_dates=True,index_col=0)
df['ED9'] = pd.read_csv('edu.csv',parse_dates=True,index_col=0).Settle
df['ED1'] = df.Settle

df = df[df.index > '2014-11-01']
df = df[df.index < '2015-07-01']
df[['ED1','ED9']].plot(ylim=(98.0,100.))
plt.savefig('tser_futures_03.png')
\end{minted}

\includegraphics[height=8cm]{tser_futures_03.png}

Kontango (Contango)

VÝS piyasalarýnda günlük fiyatýn (ya da daha yakýn tarihli sözleþme
fiyatlarýnýn) ileri tarihli sözleþme fiyatlarýndan daha düþük fiyatlý iþlem
gördüðü piyasa koþulu.  Kontangonun tersi ise "Backwardation" olarak
adlandýrýlmaktadýr Diðer isim, taþýma kazancý, daha çok döviz piyasalarýnda
biliniyor olsa da senet piyaslarý, VÝS piyasalarýnda da kullanýlabiliyor.

Taþýma Kazancý (Carry Trade)

Taþýma kazancý tekniðinin temelinde yatan görüþ þudur: fiyatlar stabildir, o
zaman geleceðin fiyatýný tahmin etmek için bugünün fiyatýný kullanabiliriz. Eðer
dünya deðiþmezse bir varlýðý elde tutmamýzla ele geçen getiri o varlýðýn doðal
getirisidir, senet olsaydý bu temettü kazancý olurdu, tahvil durumunda tahvilin
kupon getirisi (eðer borç ile alým yapýlmýþsa borca giden faizin çýkartýldýðý
hali). Mesela bugün [2015'te bir gün] Haziran 2018 Eurodollar VÝS'ini 97.94'ten
alabilirim, ya da Mart 2018'i 98.01'den alabilirim. Eðer getiri eðrisinde hiçbir
deðiþim olmazsa 3 ay sonra Haziran VÝS'i 98.01'e çýkacak demektir, ki bu
sözleþme baþýna 0.07 kazanç demektir.

Genel bir kanýya göre bu iyi bilinen durum herkesin ondan faydalanmak istemesi
sebebiyle arbitraj üzerinden yokolmalýdýr, fakat çoðunlukla bu olmuyor. TK
stratejisiyle tutarlý bir þekilde para kazanmak mümkün, tabii arada sýrada
geçici olarak sözleþmeler arasýndaki baðlantý kopar ve kazanç durumu alt üst
olur, yani bu tekniðin çok felaket bir negatif yamukluðu (negative skew)
vardýr. Benim teorim tutarlý olarak kazanýlan paranýn bu tekniðin o berbat
negatif yamukluk riskini göze alanlar için bir tür mükafat olmasý. Her neyse,
TK'nin patlama anlarýndan uzak durarak, ya da diðer stratejilerle karýþtýrarak
etkili bir þekilde kullanýlmasý mümkündür.

Peki TK nasýl bir tahminsel sinyale dönüþtürülebilir? Bu tekniðin temeli elde
tuttuðumuz kontratý daha yakýn, ya da uzak zamandaki baþka bir kontrat ile
karþýlaþtýrmaktýr. Ýki kontratýn arasýndaki fiyat farkýný alýrýz, aradaki zaman
farkýna (yýl olarak, mesela 6 ay 0.5 sene demektir) böleriz, ve ek bazý hesaplar
sonrasý (altta görülüyor) bu rakamý bir tahmine dönüþtürebiliriz. 

Geçiþ

Biraz önce Panama metotunu gösterdiðimizde daha önceden bilinen geçiþ
zamanlarýna göre birleþtirimi yaptýk. Fakat bu kontrat geçiþ zamanlarýnýn
önceden saptanmasý lazým, yani her gün hangi kontrat üzerinde olduðumuzu
bilmemiz, ve o kontratýn süresi bitmeden belli bir süre önce bir sonraki
kontrata geçmemiz gerekiyor. Geçiþ için iki kavram önemli, geçiþ döngüsü
(rollcycle) ve bitiþ tarihi (expiration date).

Her kontratýn önceden kararlaþtýrýlmýþ bir son tarihi vardýr, bu tarih ötesinde
kontrat artýk geçerli deðildir. Mesela Eurodollar kontratýnýn bitiþ tarihi
kontrat ayýnýn üçüncü Çarþamba'sýdýr, yani Temmuz 2016 kontratý için bu 20
Temmuz 2016 demektir. Diðer VÝS'ler için farklý zamanlar olabilir, bazý türler
için kontrat ayýndan bir önceki ayýn bir günü bile mümkündür.

Geçiþ anýnýn hesabý için direk bitiþ zamanýný seçebilirdik, ama o gün çok geç
olur; Kendimize bitiþ zamaný ile bugün arasýnda belli bir pay býrakmamýz iyi
olur. Bu birkaç sebepten dolayý; bir, zaman payý kontrattan çýkmak için bize
zaman esnekliði saðlar, iki, taþýma kazancýný uyguladýðýmýz zaman mesela bir ay
daha yakýn olan kontrat üzerinde fark hesaplamamýz gerekiyorsa (measuring the
rolldown) bu kontrata da geçmemek için en az 30 günlük bir pay býrakmak
lazým. Eðer daha fazla yakýnlýktaki kontrat üzerinde fark hesaplýyorsak bu pay
daha da büyük olmalý tabii ki.

Geçiþ döngüsü ise hangi aydan hangi aya atlayacaðýmýzý kontrol eder. Her kontrat
için her ay uygun deðildir, mesela ham petrol için Haziran'dan çýkýp direk bir
sonraki ay Temmuz'a mý atlamamam lazým?  Bu sorunun cevabý likiditeyle yakýn
alakalý. Tercihimiz VIS'leri likit olduklari, yani çok alaný, çok sataný olduðu
zaman alýp satmak olmalý çünkü bu durumda rahat, çabuk almak, satmak mümkün
olabilir. [4], her VÝS'in likidite davranýþý farklý olabilir der; Eurodollar her
yýlýn her ayýnda likit bir durumdadýr, fakat kýyasla ham petrol (crude oil)
böyle deðildir. Tercih edilen geçiþ döngüsünde sadece likit olan aylarý
kullanmaktýr, böylece tahminsel stratejimiz al / sat sinyalleri ürettiðinde bu
aylarda rahatça alým, satým yaparýz. 

Altta bazý örnekler görüyoruz. Bu ekranlar aracý kurumumuz tarafýndan
bize saðlanan herhangi bir günde VÝS piyasasýnda neler olduðunu, sipariþ
kayýtlarýný (order book) gösteren bir araçtan rahatça görülebilir.

Altýn (Gold)

\includegraphics[width=13cm]{case_1.png}

\includegraphics[width=13cm]{case_2.png}

Eurodollar

\includegraphics[width=13cm]{case_2.png}

Ham Petrol

\includegraphics[width=13cm]{case_3.png}

\includegraphics[width=13cm]{case_3_2.png}

ABD 10-Yýllýk Hazine Bono VÝS'i

\includegraphics[width=13cm]{case_4.png}

Likiditeyi ölçmek için [4]'ün kullandýðý yöntem üstteki ekranlarda toplam hacim
(total volume) ve kapanýþtaki açýk ilgi (open interest at close) kolonlarýna
bakmaktýr. Bu kolonlardaki rakamlar hangi ayda en yüksek ise o aylarýn
likiditesi iyi demektir. Üstteki örnekler dört deðiþik kalýbý anlatmak için
seçilmiþ, kalýplardan biri sadece önümüzdeki sene için likidite olmasý, altýn
VÝS'i buna örnek. Ýkinci kalýp ``sonsuz likidite'', Eurodollar buna örnek, Mart
2020'ye kadar her ayda likidite var, istediðimiz zaman alým satým yapmamýz
mümkün yani. Üçüncü kalýp sezonsal kalýp, eðer bir VÝS'in baz aldýðý enstrüman
tarýmsal, enerji ile alakalý ise o zaman hasat, diðer bazý periyotsal sebeplere
baðlý olarak VÝS'lerin o aylarda likiditesi artýp diðerlerinde azalabiliyor. Ham
petrol buna bir örnek, Aralýk aylarýnda çok yüksek likidite var, sonraki senenin
Ocak'ýndan baþlayarak azalýp azalýp Haziran'a kadar geliyor, orada yükseklik
var, sonra tekrar azalma. Bu tür sezonsal VÝS'lerde bir ``favori'' ay oluyor
genelde, ve bu ay'ý seçmek en iyisi. Dördüncü kalýp her sene tek ve en yakýn
kontrat durumu, ki ABD 10-yýllýk tahvil buna örnek - sadece en yakýn Haziran
likit, baþka hiçbir þans yok.

Örnek

Ham petrol VÝS'i üzerinde bu fikirleri deneyelim (kontrat kodu CL). 2007 ve 2012
arasýndaki tüm kontratlarý alalým, ve bir sözlük içinde tutalým,

\begin{minted}[fontsize=\footnotesize]{python}
import zipfile, pandas as pd, collections
ctd = collections.OrderedDict()
with zipfile.ZipFile('crude.zip', 'r') as z:
     for f in z.namelist():
     	 df = pd.read_csv(z.open(f), index_col=0,parse_dates=True )
	 k = f.replace(".csv","")
	 ctd[k] = df
         
print 'tum kontratlar', len(ctd), '200701 kontrati', len(ctd["200701"])
print type(ctd["200701"])
\end{minted}

\begin{verbatim}
tum kontratlar 72 200701 kontrati 583
<class 'pandas.core.frame.DataFrame'>
\end{verbatim}

Geçiþ döngümüz Z olacak, yani sadece Aralýk kontratlarýný alýp satacaðýz.
Bitiþten önce býrakacaðýmýz pay 50 gün olacak, yani eðer bitiþ tarihine 50 gün
var ise Z kontratýndan sonraki senenin Z kontratýna zýplýyoruz. Farklý döngüler
mümkün olabilirdi, mesela HMUZ, bu durumda 3., 6., 9. ve 12. aylar döngü
içindedir, 6'da isek 9'a zýplarýz. Alttaki kod gerekli tüm parametreleri alýp
hangi günün hangi kontrata ait olduðunu hesaplar. Gerektiði zaman zýplama
yapar. Kolon \verb!effcont! içinde ``efektif kontrat''ýn hangisi olduðu
gösterilir. 

\begin{minted}[fontsize=\footnotesize]{python}
import sys; sys.path.append('../tser_voltar')
import util
carryoffset=-1
rollcycle='Z'
rolloffset=50
expmon='prev'
expday=25

res2 = util.which_contract(contract_list=ctd, cycle=rollcycle, \
                           offset=rolloffset, \
                           expday=expday, expmon=expmon)
print res2[1000:1002]
print res2[1300:1302]
print res2[1500:1502]
\end{minted}

\begin{verbatim}
           effcont
2008-06-23  200812
2008-06-24  200812
           effcont
2009-08-17  200912
2009-08-18  200912
           effcont
2010-05-24  201012
2010-05-25  201012
\end{verbatim}

Üstteki \verb!expmon! ile özel bir þart kontrolünü yapýyoruz, eðer o deðiþkende
\verb!prev! deðeri görülürse bitiþ tarihi kontrat ayýnýn bir önceki kabul
ediliyor. Bu aslýnda garip bir durum, ama ham petrol için her nedense bu
þekilde, çoðu diðer VÝS için böyle deðil.

Þimdi ek bir TK kolonu yaratmanýn zamaný geldi. Ýlk önce TK kontratýnýn hangisi
olduðunu hesaplarýz. Bu kolay: kaç ay öncesi, ya da sonrasýndaki kontrat
kullanýlacak bu \verb!carryoffset! içinde, -1 ise bir ay önceki +3 ise 3 ay
sonraki. Örneðimiz için bir ay öncesi. Artýk bu TK kontratýnda olan fiyatý,
\verb!carryprice! kolonu olarak yazarýz, ki ileride fark hesabý için
kullanabilelim.

\begin{minted}[fontsize=\footnotesize]{python}
res3 = util.create_carry(res2[pd.isnull(res2.effcont)==False],carryoffset,ctd)
print res3[-30:-25]
\end{minted}

\begin{verbatim}
           effcont carrycont  effprice  carryprice
2012-10-08  201212    201211     89.73       89.33
2012-10-09  201212    201211     92.78       92.39
2012-10-10  201212    201211     91.64       91.25
2012-10-11  201212    201211     92.50       92.07
2012-10-12  201212    201211     92.28       91.86
\end{verbatim}

Aradaki farkýn bir sinyal oluþturabileceðini görmek için alttaki grafiði
yarattýk,mevcut kontrat ile TK kontratý fiyatlarý grafiklendi. Ufak bir suni ek
var ama, aradaki farký hesaplýyoruz, ve belli bir sabit ile çarpýp bu farký
TK'ye ekliyoruz ki aradaki fark net görülebilsin (normalde iki grafik birbirine
çok yakýn çýkýyor),

\begin{minted}[fontsize=\footnotesize]{python}
res4 = res3[(res3.index > '2008-01-01') & (res3.index <'2012-01-01')]
diff = res4.carryprice-res4.effprice # farki hesapla
res4['carryprice2'] = res4.carryprice - 10*diff # biraz buyut ki grafikte gorulsun
res4[['effprice','carryprice2']].plot()
plt.savefig('tser_futures_04.png')
\end{minted}

\includegraphics[height=8cm]{tser_futures_04.png}

Grafik ham petrolün 2008'deki o büyük düþüþ anýna odaklandý. 2008 ortalarýna
yakýn kontratýn fiyatý elimizdeki mevcut kontratýn fiyatýnýn altýna düþüyor, ve
bu bir satýþ sinyali haline geliyor. Ardýndan çýkýþta tam tersi durum, ve burada
yakýn kontrat daha yukarýda, ve alýþ sinyali baþlýyor.  Geriye dönük test
yaparak kazancýn ne kadar olabileceðini görelim. Sinyali daha önce belirttiðimiz
gibi hesaplarýz (fiyat farký bölü zaman farký, ve diðer bazý ek hesaplar). 

\begin{minted}[fontsize=\footnotesize]{python}
def carry(daily_ann_roll, vol, smooth_days=90):
    ann_stdev = vol * util.ROOT_BDAYS_INYEAR
    raw_carry = daily_ann_roll / ann_stdev
    smooth_carry = pd.ewma(raw_carry, smooth_days)
    return smooth_carry.fillna(method='ffill')

vol = util.robust_vol_calc(res3.effprice.diff())
raw_carry = (res3.effprice-res3.carryprice) / (carryoffset/12.)
forecast =  carry(raw_carry, vol)
\end{minted}

Bölümdeki \verb!carryoffset!'in eksi ya da artý deðerli olmasýný ufak bir numara
üzerinden kullanýyoruz; eksi deðerli olduðu zamam bölünendeki çýkartma iþlem
tersine dönmüþ olur, yani TK kolonu eksi efektif kolon. Eðer artý olsaydý
efektif eksi TK olacaktý. Bu iþlemin [4]'e göre yapýlmasý gerekiyor. 

Kaynaklar

[1] Wikipedia, {\em Futures contract}, \url{https://en.wikipedia.org/wiki/Futures_contract}

[3] Heakal, {\em Futures Fundamentals: How The Market Works}, \url{http://www.investopedia.com/university/futures/futures2.asp}

[4] Carver, {\em Systems building - futures rolling}, \url{http://qoppac.blogspot.co.uk/2015/05/systems-building-futures-rolling.html}

\end{document}

